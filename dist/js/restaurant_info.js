let restaurant,reviews;var map;document.addEventListener("DOMContentLoaded",e=>{DBHelper.registerServiceWorker(),this._toastsView=new Toast,fetchRestaurantFromURL()}),window.initMap=(()=>{self.restaurant&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))}),fetchRestaurantFromURL=(()=>{if(self.restaurant)return;const e=getParameterByName("id");e?DBHelper.fetchDataById("restaurants",e,(t,n)=>{self.restaurant=n,!t||n?DBHelper.fetchReviewsByRestaurantId(e,(e,t)=>{self.reviews=t.reverse(),e&&showNotification(e),fillRestaurantHTML(),Helper.lazyLoad()}):showNotification(t)}):showNotification("No restaurant id in URL")}),fillRestaurantHTML=((e=self.restaurant)=>{fillBreadcrumb();const t=document.getElementsByTagName("head")[0],n=document.createElement("meta");n.setAttribute("name","description"),n.setAttribute("content",`Detailed information about ${e.name}`),t.append(n);const a=document.getElementById("restaurant-name");a.innerHTML=e.name,a.title="restaurant name";const r=document.createElement("input");r.type="checkbox",r.name="favourite",r.value="favourite",r.id="favourite",r.checked=e.is_favorite,r.setAttribute("onchange","updateIsFavourite()");const i=document.createElement("label");i.setAttribute("for","favourite"),a.appendChild(r),a.appendChild(i);const s=document.getElementById("restaurant-address");s.innerHTML=e.address,s.title="restaurant address";const o=DBHelper.imageUrlForRestaurant(e,!0),l=document.getElementById("restaurant-img");l.className="restaurant-img",l.classList.add("lazy"),l.src=o,l.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),l.setAttribute("data-srcset",DBHelper.imageSRCSetUrlsForRestaurant(e,["1x","2x"])),l.alt=e.photograph?DBHelper.getPhotoDescription(e):"no picture found";const c=document.getElementById("restaurant-cuisine");c.innerHTML=e.cuisine_type,c.title="restaurant cuisine type",e.operating_hours&&fillRestaurantHoursHTML(),fillSubmitReviewFormHTML(),fillReviewsHTML()}),updateIsFavourite=((e=self.restaurant)=>{const t=e.is_favorite?0:1,n=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"}),a={restaurant_id:parseInt(e.id),is_favorite:t,createdAt:n};return DBHelper._updateDB("newIsFavourite",a),navigator.serviceWorker.ready.then(e=>e.sync.register("send-isFavourite")).then(()=>{e.is_favorite=!!t,DBHelper._updateDB("restaurants",e),showNotification(`Restaurant is ${t?"favourite now :)":"not favourite anymore :("}`)}).catch(()=>{showNotification("Oops! Something went wrong. :(")})}),showNotification=((e,t={buttons:["dismiss"]})=>{this._toastsView.create(e,t)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.className="openhours-day",a.appendChild(r);const i=document.createElement("td");i.innerHTML=e[n],i.className="openhours-time",a.appendChild(i),t.appendChild(a)}}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),0===e.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const a=document.getElementById("reviews-list");e.forEach(e=>{a.appendChild(createReviewHTML(e))}),t.appendChild(a)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,n.className="review-name",n.title="reviewer's name",t.appendChild(n);const a=document.createElement("p"),r=new Date(e.createdAt).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});a.innerHTML=r,a.className="review-date",a.title="date when review was posted",t.appendChild(a);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,i.className="review-rating",i.title="given rating",t.appendChild(i);const s=document.createElement("p");return s.innerHTML=e.comments,s.className="review-comments",s.title="comments from the reviewer",t.appendChild(s),t}),fillSubmitReviewFormHTML=((e=self.restaurant)=>{const t=document.getElementById("reviews-list"),n=document.createElement("li"),a=document.createElement("form");a.id="form-review",a.method="POST",a.setAttribute("aria-label","Add review for restaurant");const r=document.createElement("input");r.id="restaurant_id",r.name="restaurant_id",r.type="hidden",r.value=e.id,a.appendChild(r);const i=document.createElement("p");i.className="review-name";const s=document.createElement("label");s.innerHTML="* Name:",s.for="uName",s.title="reviewer's name",i.appendChild(s);const o=document.createElement("input");o.id="uName",o.name="name",o.placeholder="Your Name",o.setAttribute("aria-required","true"),o.setAttribute("aria-label","Your name"),s.appendChild(o),a.appendChild(i);const l=document.createElement("p"),c=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});l.innerHTML=c,l.className="review-date",l.title="date when review is posted",a.appendChild(l);const d=document.createElement("p");d.className="review-rating";const m=document.createElement("label");m.innerHTML="Rating:";const u=document.createElement("select");u.name="rating";for(var p=1;p<=5;p++){const e=document.createElement("option");e.value=p,e.innerHTML=p,u.appendChild(e)}m.appendChild(u),d.appendChild(m),a.appendChild(d);const h=document.createElement("p");h.className="review-comments";const w=document.createElement("label");w.innerHTML="* Comments:";const v=document.createElement("textarea");v.name="comments",v.id="commentsText",v.setAttribute("aria-required","true"),v.setAttribute("aria-label","Additional comments for the review"),h.appendChild(w),h.appendChild(v),a.appendChild(h);const f=document.createElement("p"),g=document.createElement("button");g.id="submitBtn",g.type="submit",g.innerHTML="Submit Review!",g.value="Submit",g.setAttribute("aria-label","Submit review"),f.appendChild(g),a.appendChild(f),n.appendChild(a),t.appendChild(n),a.addEventListener("submit",function(e){e.preventDefault(),submitReview(a)})}),submitReview=(e=>{const t=new FormData(e),n={};let a=!1;if(t.forEach(function(e,t){const r=escape(e);""===r&&(showNotification(`Oh no! Something went wrong, please check ${t} field`),a=!0),n[t]=r}),n.restaurant_id=parseInt(n.restaurant_id),n.rating=parseInt(n.rating),a)return;let r=e.parentNode.parentNode;const i=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});n.createdAt=i,DBHelper._updateDB("newR",n),DBHelper._updateDB("reviews",n);let s=createReviewHTML(n);return navigator.serviceWorker.ready.then(e=>e.sync.register("send-reviews")).then(()=>{showNotification("Your review will be posted as soon as possible."),r.insertBefore(s,e.parentNode),r.removeChild(e.parentNode)}).catch(()=>{showNotification("Error")})}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.setAttribute("aria-current","page"),n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm1hcCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiREJIZWxwZXIiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJ0aGlzIiwiX3RvYXN0c1ZpZXciLCJUb2FzdCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJ3aW5kb3ciLCJpbml0TWFwIiwic2VsZiIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJnZXRFbGVtZW50QnlJZCIsInpvb20iLCJjZW50ZXIiLCJsYXRsbmciLCJzY3JvbGx3aGVlbCIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJpZCIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoRGF0YUJ5SWQiLCJlcnJvciIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkIiwicmV2ZXJzZSIsInNob3dOb3RpZmljYXRpb24iLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJIZWxwZXIiLCJsYXp5TG9hZCIsImZpbGxCcmVhZGNydW1iIiwiaGVhZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZGVzY3JpcHRpb24iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwibmFtZSIsImFwcGVuZCIsImlubmVySFRNTCIsInRpdGxlIiwiZmF2b3VyaXRlVG9nZ2xlIiwidHlwZSIsInZhbHVlIiwiY2hlY2tlZCIsImlzX2Zhdm9yaXRlIiwidG9nZ2xlTGJsIiwiYXBwZW5kQ2hpbGQiLCJhZGRyZXNzIiwiaW1nU3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJhZGQiLCJzcmMiLCJpbWFnZVNSQ1NldFVybHNGb3JSZXN0YXVyYW50IiwiYWx0IiwiZ2V0UGhvdG9EZXNjcmlwdGlvbiIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxTdWJtaXRSZXZpZXdGb3JtSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsInVwZGF0ZUlzRmF2b3VyaXRlIiwibm93IiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIm1vbnRoIiwiZGF5IiwieWVhciIsImlzRmF2b3VyaXRlIiwicmVzdGF1cmFudF9pZCIsInBhcnNlSW50IiwiY3JlYXRlZEF0IiwiX3VwZGF0ZURCIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlYWR5IiwidGhlbiIsInJlZyIsInN5bmMiLCJyZWdpc3RlciIsImNhdGNoIiwibXNnIiwib3B0aW9ucyIsImJ1dHRvbnMiLCJjcmVhdGUiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwidGltZSIsImNvbnRhaW5lciIsImxlbmd0aCIsIm5vUmV2aWV3cyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImRhdGUiLCJyYXRpbmciLCJjb21tZW50cyIsImZvcm0iLCJtZXRob2QiLCJyZXN0YXVyYW50SUQiLCJuYW1lU2hlbGwiLCJuYW1lTGJsIiwiZm9yIiwibmFtZUlucHV0IiwicGxhY2Vob2xkZXIiLCJyYXRpbmdTaGVsbCIsInJhdGluZ0xibCIsInJhdGluZ09wdGlvbnMiLCJpIiwib3B0aW9uIiwiY29tbWVudHNTaGVsbCIsImNvbW1lbnRzTGJsIiwiY29tbWVudHNUZXh0Iiwic3VibWl0U2hlbGwiLCJzdWJtaXRCdG4iLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdFJldmlldyIsIkZEIiwiRm9ybURhdGEiLCJiYWREYXRhIiwic2FmZVN0ciIsImVzY2FwZSIsInBhcmVudE5vZGUiLCJyZXZpZXdOb2RlIiwiaW5zZXJ0QmVmb3JlIiwicmVtb3ZlQ2hpbGQiLCJicmVhZGNydW1iIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlc3VsdHMiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxXQUFZQyxRQUNoQixJQUFJQyxJQUtKQyxTQUFTQyxpQkFBaUIsbUJBQXFCQyxJQUM3Q0MsU0FBU0Msd0JBQ1RDLEtBQUtDLFlBQWMsSUFBSUMsTUFDdkJDLDJCQU1GQyxPQUFPQyxRQUFVLE1BQ1hDLEtBQUtkLGFBQ1BjLEtBQUtaLElBQU0sSUFBSWEsT0FBT0MsS0FBS0MsSUFBSWQsU0FBU2UsZUFBZSxPQUFRLENBQzdEQyxLQUFNLEdBQ05DLE9BQVFOLEtBQUtkLFdBQVdxQixPQUN4QkMsYUFBYSxJQUVmaEIsU0FBU2lCLHVCQUF1QlQsS0FBS2QsV0FBWWMsS0FBS1osUUFPMURTLHVCQUF5QixNQUN2QixHQUFJRyxLQUFLZCxXQUVQLE9BRUYsTUFBTXdCLEVBQUtDLG1CQUFtQixNQUN6QkQsRUFLSGxCLFNBQVNvQixjQUFjLGNBQWVGLEVBQUksQ0FBQ0csRUFBTzNCLEtBQ2hEYyxLQUFLZCxXQUFhQSxHQUNkMkIsR0FBVTNCLEVBS2RNLFNBQVNzQiwyQkFBMkJKLEVBQUksQ0FBQ0csRUFBTzFCLEtBQzlDYSxLQUFLYixRQUFVQSxFQUFRNEIsVUFDbkJGLEdBQ0ZHLGlCQUFpQkgsR0FHbkJJLHFCQUNBQyxPQUFPQyxhQVhQSCxpQkFBaUJILEtBTnJCRyxpQkFBaUIsNkJBMEJyQkMsbUJBQXFCLEVBQUMvQixFQUFhYyxLQUFLZCxjQUN0Q2tDLGlCQUVBLE1BQU1DLEVBQU9oQyxTQUFTaUMscUJBQXFCLFFBQVEsR0FDN0NDLEVBQWNsQyxTQUFTbUMsY0FBYyxRQUMzQ0QsRUFBWUUsYUFBYSxPQUFRLGVBQ2pDRixFQUFZRSxhQUFhLHdDQUF5Q3ZDLEVBQVd3QyxRQUM3RUwsRUFBS00sT0FBT0osR0FFWixNQUFNRyxFQUFPckMsU0FBU2UsZUFBZSxtQkFDckNzQixFQUFLRSxVQUFZMUMsRUFBV3dDLEtBQzVCQSxFQUFLRyxNQUFRLGtCQUNiLE1BQU1DLEVBQWtCekMsU0FBU21DLGNBQWMsU0FDL0NNLEVBQWdCQyxLQUFPLFdBQ3ZCRCxFQUFnQkosS0FBTyxZQUN2QkksRUFBZ0JFLE1BQVEsWUFDeEJGLEVBQWdCcEIsR0FBSyxZQUNyQm9CLEVBQWdCRyxRQUFVL0MsRUFBV2dELFlBQ3JDSixFQUFnQkwsYUFBYSxXQUFZLHVCQUN6QyxNQUFNVSxFQUFZOUMsU0FBU21DLGNBQWMsU0FDekNXLEVBQVVWLGFBQWEsTUFBTyxhQUM5QkMsRUFBS1UsWUFBWU4sR0FDakJKLEVBQUtVLFlBQVlELEdBRWpCLE1BQU1FLEVBQVVoRCxTQUFTZSxlQUFlLHNCQUN4Q2lDLEVBQVFULFVBQVkxQyxFQUFXbUQsUUFDL0JBLEVBQVFSLE1BQVEscUJBRWhCLE1BQU1TLEVBQVM5QyxTQUFTK0Msc0JBQXNCckQsR0FBWSxHQUNwRHNELEVBQVFuRCxTQUFTZSxlQUFlLGtCQUN0Q29DLEVBQU1DLFVBQVksaUJBQ2xCRCxFQUFNRSxVQUFVQyxJQUFJLFFBQ3BCSCxFQUFNSSxJQUFNTixFQUNaRSxFQUFNZixhQUFhLFdBQVlqQyxTQUFTK0Msc0JBQXNCckQsSUFDOURzRCxFQUFNZixhQUFhLGNBQWVqQyxTQUFTcUQsNkJBQTZCM0QsRUFBWSxDQUFDLEtBQU0sUUFDM0ZzRCxFQUFNTSxJQUFPNUQsRUFBcUIsV0FBSU0sU0FBU3VELG9CQUFvQjdELEdBQ25FLG1CQUVBLE1BQU04RCxFQUFVM0QsU0FBU2UsZUFBZSxzQkFDeEM0QyxFQUFRcEIsVUFBWTFDLEVBQVcrRCxhQUMvQkQsRUFBUW5CLE1BQVEsMEJBR1ozQyxFQUFXZ0UsaUJBQ2JDLDBCQUdGQywyQkFFQUMsb0JBTURDLGtCQUFvQixFQUFDcEUsRUFBYWMsS0FBS2QsY0FDckMsTUFBTWdELEVBQWVoRCxFQUFzQixZQUFJLEVBQUksRUFHN0NxRSxHQUFNLElBQUlDLE1BQU9DLG1CQUFtQixRQUQxQixDQUFDQyxNQUFPLE9BQVFDLElBQUssVUFBV0MsS0FBTSxZQUVoREMsRUFBYyxDQUNsQkMsY0FBaUJDLFNBQVM3RSxFQUFXd0IsSUFDckN3QixZQUFlQSxFQUNmOEIsVUFBYVQsR0FLZixPQUZBL0QsU0FBU3lFLFVBQVUsaUJBQWtCSixHQUU5QkssVUFBVUMsY0FBY0MsTUFBTUMsS0FBS0MsR0FDakNBLEVBQUlDLEtBQUtDLFNBQVMscUJBQ3hCSCxLQUFLLEtBQ05uRixFQUFXZ0QsY0FBYyxFQUN6QjFDLFNBQVN5RSxVQUFVLGNBQWUvRSxHQUNsQzhCLGtDQUFrQyxFQUFnQixtQkFBcUIsZ0NBQ3RFeUQsTUFBTSxLQUNQekQsaUJBQWlCLHNDQWF0QkEsaUJBQW1CLEVBQUMwRCxFQUFLQyxFQUFVLENBQUNDLFFBQVMsQ0FBQyxlQUM1Q2xGLEtBQUtDLFlBQVlrRixPQUFPSCxFQUFLQyxLQU0vQnhCLHdCQUEwQixFQUFDMkIsRUFBaUI5RSxLQUFLZCxXQUFXZ0UsbUJBQzFELE1BQU02QixFQUFRMUYsU0FBU2UsZUFBZSxvQkFDdEMsSUFBSyxJQUFJNEUsS0FBT0YsRUFBZ0IsQ0FDOUIsTUFBTUcsRUFBTTVGLFNBQVNtQyxjQUFjLE1BRTdCbUMsRUFBTXRFLFNBQVNtQyxjQUFjLE1BQ25DbUMsRUFBSS9CLFVBQVlvRCxFQUNoQnJCLEVBQUlsQixVQUFZLGdCQUNoQndDLEVBQUk3QyxZQUFZdUIsR0FFaEIsTUFBTXVCLEVBQU83RixTQUFTbUMsY0FBYyxNQUNwQzBELEVBQUt0RCxVQUFZa0QsRUFBZUUsR0FDaENFLEVBQUt6QyxVQUFZLGlCQUNqQndDLEVBQUk3QyxZQUFZOEMsR0FFaEJILEVBQU0zQyxZQUFZNkMsTUFPdEI1QixnQkFBa0IsRUFBQ2xFLEVBQVVhLEtBQUtiLFdBQ2hDLE1BQU1nRyxFQUFZOUYsU0FBU2UsZUFBZSxxQkFDcEN5QixFQUFReEMsU0FBU21DLGNBQWMsTUFJckMsR0FIQUssRUFBTUQsVUFBWSxVQUNsQnVELEVBQVUvQyxZQUFZUCxHQUVDLElBQW5CMUMsRUFBUWlHLE9BQWMsQ0FDeEIsTUFBTUMsRUFBWWhHLFNBQVNtQyxjQUFjLEtBR3pDLE9BRkE2RCxFQUFVekQsVUFBWSx1QkFDdEJ1RCxFQUFVL0MsWUFBWWlELEdBR3hCLE1BQU1DLEVBQUtqRyxTQUFTZSxlQUFlLGdCQUNuQ2pCLEVBQVFvRyxRQUFRQyxJQUNkRixFQUFHbEQsWUFBWXFELGlCQUFpQkQsTUFFbENMLEVBQVUvQyxZQUFZa0QsS0FNeEJHLGlCQUFtQixDQUFDRCxJQUNsQixNQUFNRSxFQUFLckcsU0FBU21DLGNBQWMsTUFDNUJFLEVBQU9yQyxTQUFTbUMsY0FBYyxLQUNwQ0UsRUFBS0UsVUFBWTRELEVBQU85RCxLQUN4QkEsRUFBS2UsVUFBWSxjQUNqQmYsRUFBS0csTUFBUSxrQkFDYjZELEVBQUd0RCxZQUFZVixHQUVmLE1BQU1pRSxFQUFPdEcsU0FBU21DLGNBQWMsS0FFOUJ3QyxFQUFZLElBQUlSLEtBQUtnQyxFQUFPeEIsV0FBV1AsbUJBQW1CLFFBRGhELENBQUNDLE1BQU8sT0FBUUMsSUFBSyxVQUFXQyxLQUFNLFlBRXREK0IsRUFBSy9ELFVBQVlvQyxFQUNqQjJCLEVBQUtsRCxVQUFZLGNBQ2pCa0QsRUFBSzlELE1BQVEsOEJBQ2I2RCxFQUFHdEQsWUFBWXVELEdBRWYsTUFBTUMsRUFBU3ZHLFNBQVNtQyxjQUFjLEtBQ3RDb0UsRUFBT2hFLHFCQUF1QjRELEVBQU9JLFNBQ3JDQSxFQUFPbkQsVUFBWSxnQkFDbkJtRCxFQUFPL0QsTUFBUSxlQUNmNkQsRUFBR3RELFlBQVl3RCxHQUVmLE1BQU1DLEVBQVd4RyxTQUFTbUMsY0FBYyxLQU14QyxPQUxBcUUsRUFBU2pFLFVBQVk0RCxFQUFPSyxTQUM1QkEsRUFBU3BELFVBQVksa0JBQ3JCb0QsRUFBU2hFLE1BQVEsNkJBQ2pCNkQsRUFBR3RELFlBQVl5RCxHQUVSSCxJQU1UdEMseUJBQTJCLEVBQUNsRSxFQUFhYyxLQUFLZCxjQUM1QyxNQUFNb0csRUFBS2pHLFNBQVNlLGVBQWUsZ0JBRTdCc0YsRUFBS3JHLFNBQVNtQyxjQUFjLE1BQzVCc0UsRUFBT3pHLFNBQVNtQyxjQUFjLFFBQ3BDc0UsRUFBS3BGLEdBQUssY0FDVm9GLEVBQUtDLE9BQVMsT0FDZEQsRUFBS3JFLGFBQWEsYUFBYyw2QkFFaEMsTUFBTXVFLEVBQWUzRyxTQUFTbUMsY0FBYyxTQUM1Q3dFLEVBQWF0RixHQUFLLGdCQUNsQnNGLEVBQWF0RSxLQUFPLGdCQUNwQnNFLEVBQWFqRSxLQUFPLFNBQ3BCaUUsRUFBYWhFLE1BQVE5QyxFQUFXd0IsR0FDaENvRixFQUFLMUQsWUFBWTRELEdBRWpCLE1BQU1DLEVBQVk1RyxTQUFTbUMsY0FBYyxLQUN6Q3lFLEVBQVV4RCxVQUFZLGNBQ3RCLE1BQU15RCxFQUFVN0csU0FBU21DLGNBQWMsU0FDdkMwRSxFQUFRdEUsVUFBWSxVQUNwQnNFLEVBQVFDLElBQU0sUUFDZEQsRUFBUXJFLE1BQVEsa0JBQ2hCb0UsRUFBVTdELFlBQVk4RCxHQUV0QixNQUFNRSxFQUFZL0csU0FBU21DLGNBQWMsU0FDekM0RSxFQUFVMUYsR0FBSyxRQUNmMEYsRUFBVTFFLEtBQU8sT0FDakIwRSxFQUFVQyxZQUFjLFlBQ3hCRCxFQUFVM0UsYUFBYSxnQkFBaUIsUUFDeEMyRSxFQUFVM0UsYUFBYSxhQUFjLGFBQ3JDeUUsRUFBUTlELFlBQVlnRSxHQUNwQk4sRUFBSzFELFlBQVk2RCxHQUVqQixNQUFNTixFQUFPdEcsU0FBU21DLGNBQWMsS0FFOUIrQixHQUFNLElBQUlDLE1BQU9DLG1CQUFtQixRQUQxQixDQUFDQyxNQUFPLE9BQVFDLElBQUssVUFBV0MsS0FBTSxZQUV0RCtCLEVBQUsvRCxVQUFZMkIsRUFDakJvQyxFQUFLbEQsVUFBWSxjQUNqQmtELEVBQUs5RCxNQUFRLDZCQUNiaUUsRUFBSzFELFlBQVl1RCxHQUVqQixNQUFNVyxFQUFjakgsU0FBU21DLGNBQWMsS0FDM0M4RSxFQUFZN0QsVUFBWSxnQkFDeEIsTUFBTThELEVBQVlsSCxTQUFTbUMsY0FBYyxTQUN6QytFLEVBQVUzRSxVQUFZLFVBQ3RCLE1BQU00RSxFQUFnQm5ILFNBQVNtQyxjQUFjLFVBQzdDZ0YsRUFBYzlFLEtBQU8sU0FDckIsSUFBSyxJQUFJK0UsRUFBSSxFQUFHQSxHQUFLLEVBQUdBLElBQUssQ0FDM0IsTUFBTUMsRUFBU3JILFNBQVNtQyxjQUFjLFVBQ3RDa0YsRUFBTzFFLE1BQVF5RSxFQUNmQyxFQUFPOUUsVUFBWTZFLEVBQ25CRCxFQUFjcEUsWUFBWXNFLEdBRTVCSCxFQUFVbkUsWUFBWW9FLEdBQ3RCRixFQUFZbEUsWUFBWW1FLEdBQ3hCVCxFQUFLMUQsWUFBWWtFLEdBRWpCLE1BQU1LLEVBQWdCdEgsU0FBU21DLGNBQWMsS0FDN0NtRixFQUFjbEUsVUFBWSxrQkFDMUIsTUFBTW1FLEVBQWN2SCxTQUFTbUMsY0FBYyxTQUMzQ29GLEVBQVloRixVQUFZLGNBQ3hCLE1BQU1pRixFQUFleEgsU0FBU21DLGNBQWMsWUFDNUNxRixFQUFhbkYsS0FBTyxXQUNwQm1GLEVBQWFuRyxHQUFLLGVBQ2xCbUcsRUFBYXBGLGFBQWEsZ0JBQWlCLFFBQzNDb0YsRUFBYXBGLGFBQWEsYUFBYyxzQ0FDeENrRixFQUFjdkUsWUFBWXdFLEdBQzFCRCxFQUFjdkUsWUFBWXlFLEdBQzFCZixFQUFLMUQsWUFBWXVFLEdBRWpCLE1BQU1HLEVBQWN6SCxTQUFTbUMsY0FBYyxLQUNyQ3VGLEVBQVkxSCxTQUFTbUMsY0FBYyxVQUN6Q3VGLEVBQVVyRyxHQUFLLFlBQ2ZxRyxFQUFVaEYsS0FBTyxTQUNqQmdGLEVBQVVuRixVQUFZLGlCQUN0Qm1GLEVBQVUvRSxNQUFRLFNBQ2xCK0UsRUFBVXRGLGFBQWEsYUFBYyxpQkFDckNxRixFQUFZMUUsWUFBWTJFLEdBQ3hCakIsRUFBSzFELFlBQVkwRSxHQUVqQnBCLEVBQUd0RCxZQUFZMEQsR0FDZlIsRUFBR2xELFlBQVlzRCxHQUVmSSxFQUFLeEcsaUJBQWlCLFNBQVUsU0FBVUMsR0FDeENBLEVBQU15SCxpQkFFTkMsYUFBYW5CLE9BT2pCbUIsYUFBZSxDQUFDbkIsSUFFZCxNQUFNb0IsRUFBSyxJQUFJQyxTQUFTckIsR0FFbEJOLEVBQVMsR0FDZixJQUFJNEIsR0FBVSxFQWNkLEdBYkFGLEVBQUczQixRQUFRLFNBQVN2RCxFQUFPZ0QsR0FDekIsTUFBTXFDLEVBQVVDLE9BQU90RixHQUNQLEtBQVpxRixJQUNGckcsOERBQThEZ0UsV0FDOURvQyxHQUFVLEdBRVo1QixFQUFPUixHQUFPcUMsSUFHaEI3QixFQUFPMUIsY0FBZ0JDLFNBQVN5QixFQUFPMUIsZUFDdkMwQixFQUFPSSxPQUFTN0IsU0FBU3lCLEVBQU9JLFFBRzVCd0IsRUFDRixPQUdGLElBQUk5QixFQUFLUSxFQUFLeUIsV0FBV0EsV0FFekIsTUFDTWhFLEdBQU0sSUFBSUMsTUFBT0MsbUJBQW1CLFFBRDFCLENBQUNDLE1BQU8sT0FBUUMsSUFBSyxVQUFXQyxLQUFNLFlBRXRENEIsRUFBa0IsVUFBSWpDLEVBQ3RCL0QsU0FBU3lFLFVBQVUsT0FBUXVCLEdBQzNCaEcsU0FBU3lFLFVBQVUsVUFBV3VCLEdBRTlCLElBQUlnQyxFQUFhL0IsaUJBQWlCRCxHQUVsQyxPQUFPdEIsVUFBVUMsY0FBY0MsTUFBTUMsS0FBS0MsR0FDakNBLEVBQUlDLEtBQUtDLFNBQVMsaUJBQ3hCSCxLQUFLLEtBQ05yRCxpQkFBaUIsbURBQ2pCc0UsRUFBR21DLGFBQWFELEVBQVkxQixFQUFLeUIsWUFDakNqQyxFQUFHb0MsWUFBWTVCLEVBQUt5QixjQUNuQjlDLE1BQU0sS0FDUHpELGlCQUFpQixhQU9yQkksZUFBaUIsRUFBQ2xDLEVBQWFjLEtBQUtkLGNBQ2xDLE1BQU15SSxFQUFhdEksU0FBU2UsZUFBZSxjQUNyQ3NGLEVBQUtyRyxTQUFTbUMsY0FBYyxNQUNsQ2tFLEVBQUdqRSxhQUFhLGVBQWdCLFFBQ2hDaUUsRUFBRzlELFVBQVkxQyxFQUFXd0MsS0FDMUJpRyxFQUFXdkYsWUFBWXNELEtBTXpCL0UsbUJBQXFCLEVBQUNlLEVBQU1rRyxLQUNyQkEsSUFDSEEsRUFBTTlILE9BQU8rSCxTQUFTQyxNQUN4QnBHLEVBQU9BLEVBQUtxRyxRQUFRLFVBQVcsUUFDL0IsTUFDRUMsRUFEWSxJQUFJQyxjQUFjdkcsc0JBQ2R3RyxLQUFLTixHQUN2QixPQUFLSSxFQUVBQSxFQUFRLEdBRU5HLG1CQUFtQkgsRUFBUSxHQUFHRCxRQUFRLE1BQU8sTUFEM0MsR0FGQSIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudCwgcmV2aWV3cztcbnZhciBtYXA7XG5cbi8qKlxuICogRmV0Y2ggZGF0YSBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBEQkhlbHBlci5yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcbiAgdGhpcy5fdG9hc3RzVmlldyA9IG5ldyBUb2FzdCgpO1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKCk7XG59KTtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7XG4gICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgem9vbTogMTYsXG4gICAgICBjZW50ZXI6IHNlbGYucmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICB9KTtcbiAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKCkgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIC8vY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkge1xuICAgIC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIHNob3dOb3RpZmljYXRpb24oJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJyk7XG4gICAgcmV0dXJuO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoRGF0YUJ5SWQoJ3Jlc3RhdXJhbnRzJywgaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmIChlcnJvciAmJiAhcmVzdGF1cmFudCkge1xuICAgICAgICBzaG93Tm90aWZpY2F0aW9uKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBEQkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChpZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gICAgICAgIHNlbGYucmV2aWV3cyA9IHJldmlld3MucmV2ZXJzZSgpO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgICBIZWxwZXIubGF6eUxvYWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgZmlsbEJyZWFkY3J1bWIoKTtcblxuICBjb25zdCBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJyk7XG4gIGRlc2NyaXB0aW9uLnNldEF0dHJpYnV0ZSgnbmFtZScsICdkZXNjcmlwdGlvbicpO1xuICBkZXNjcmlwdGlvbi5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnLCBgRGV0YWlsZWQgaW5mb3JtYXRpb24gYWJvdXQgJHtyZXN0YXVyYW50Lm5hbWV9YCk7XG4gIGhlYWQuYXBwZW5kKGRlc2NyaXB0aW9uKTtcblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbmFtZS50aXRsZSA9ICdyZXN0YXVyYW50IG5hbWUnO1xuICBjb25zdCBmYXZvdXJpdGVUb2dnbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBmYXZvdXJpdGVUb2dnbGUudHlwZSA9ICdjaGVja2JveCc7XG4gIGZhdm91cml0ZVRvZ2dsZS5uYW1lID0gJ2Zhdm91cml0ZSc7XG4gIGZhdm91cml0ZVRvZ2dsZS52YWx1ZSA9ICdmYXZvdXJpdGUnO1xuICBmYXZvdXJpdGVUb2dnbGUuaWQgPSAnZmF2b3VyaXRlJztcbiAgZmF2b3VyaXRlVG9nZ2xlLmNoZWNrZWQgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlO1xuICBmYXZvdXJpdGVUb2dnbGUuc2V0QXR0cmlidXRlKCdvbmNoYW5nZScsICd1cGRhdGVJc0Zhdm91cml0ZSgpJyk7XG4gIGNvbnN0IHRvZ2dsZUxibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHRvZ2dsZUxibC5zZXRBdHRyaWJ1dGUoJ2ZvcicsICdmYXZvdXJpdGUnKTtcbiAgbmFtZS5hcHBlbmRDaGlsZChmYXZvdXJpdGVUb2dnbGUpO1xuICBuYW1lLmFwcGVuZENoaWxkKHRvZ2dsZUxibCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGFkZHJlc3MudGl0bGUgPSAncmVzdGF1cmFudCBhZGRyZXNzJztcblxuICBjb25zdCBpbWdTcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgdHJ1ZSk7XG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLmNsYXNzTGlzdC5hZGQoJ2xhenknKTtcbiAgaW1hZ2Uuc3JjID0gaW1nU3JjO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpKTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsIERCSGVscGVyLmltYWdlU1JDU2V0VXJsc0ZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgWycxeCcsICcyeCddKSk7XG4gIGltYWdlLmFsdCA9IChyZXN0YXVyYW50LnBob3RvZ3JhcGgpID8gREJIZWxwZXIuZ2V0UGhvdG9EZXNjcmlwdGlvbihyZXN0YXVyYW50KSA6XG4gICdubyBwaWN0dXJlIGZvdW5kJztcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuICBjdWlzaW5lLnRpdGxlID0gJ3Jlc3RhdXJhbnQgY3Vpc2luZSB0eXBlJztcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgc3VibWl0IHJldmlldyBmb3JtXG4gIGZpbGxTdWJtaXRSZXZpZXdGb3JtSFRNTCgpO1xuICAvLyBmaWxsIHJldmlld3NcbiAgZmlsbFJldmlld3NIVE1MKCk7XG59XG5cbi8qKlxuICogSGFkbGUgZmF2b3VyaXRlIHRvZ2dsZVxuICovXG4gdXBkYXRlSXNGYXZvdXJpdGUgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICAgY29uc3QgaXNfZmF2b3JpdGUgPSAocmVzdGF1cmFudC5pc19mYXZvcml0ZSkgPyAwIDogMTtcblxuICAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICAgY29uc3QgaXNGYXZvdXJpdGUgPSB7XG4gICAgIFwicmVzdGF1cmFudF9pZFwiOiBwYXJzZUludChyZXN0YXVyYW50LmlkKSxcbiAgICAgXCJpc19mYXZvcml0ZVwiOiBpc19mYXZvcml0ZSxcbiAgICAgXCJjcmVhdGVkQXRcIjogbm93XG4gICB9XG5cbiAgIERCSGVscGVyLl91cGRhdGVEQignbmV3SXNGYXZvdXJpdGUnLCBpc0Zhdm91cml0ZSk7XG5cbiAgIHJldHVybiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeS50aGVuKHJlZyA9PiB7XG4gICAgIHJldHVybiByZWcuc3luYy5yZWdpc3Rlcignc2VuZC1pc0Zhdm91cml0ZScpXG4gICB9KS50aGVuKCgpID0+IHtcbiAgICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IChpc19mYXZvcml0ZSkgPyB0cnVlIDogZmFsc2U7XG4gICAgIERCSGVscGVyLl91cGRhdGVEQigncmVzdGF1cmFudHMnLCByZXN0YXVyYW50KTtcbiAgICAgc2hvd05vdGlmaWNhdGlvbihgUmVzdGF1cmFudCBpcyAkeyhpc19mYXZvcml0ZSkgPyAnZmF2b3VyaXRlIG5vdyA6KScgOiAnbm90IGZhdm91cml0ZSBhbnltb3JlIDooJ31gKTtcbiAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgc2hvd05vdGlmaWNhdGlvbignT29wcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuIDooJyk7XG4gICB9KTtcblxuICAgLypcblxuICAgeGhyLm9wZW4oJ1BVVCcsIHdpbmRvdy5sb2NhdGlvbi5ocmVmLCB0cnVlKTtcbiAgIHhoci5zZW5kKGBpc19mYXZvcml0ZT0ke2lzX2Zhdm9yaXRlfSZyZXN0YXVyYW50X2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcbiAgICovXG4gfVxuXG4vKipcbiAqIERpc3BsYXkgbm90aWZpY2F0aW9ucy5cbiAqL1xuc2hvd05vdGlmaWNhdGlvbiA9IChtc2csIG9wdGlvbnMgPSB7YnV0dG9uczogWydkaXNtaXNzJ119KSA9PiB7XG4gIHRoaXMuX3RvYXN0c1ZpZXcuY3JlYXRlKG1zZywgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICBkYXkuY2xhc3NOYW1lID0gJ29wZW5ob3Vycy1kYXknO1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHRpbWUuY2xhc3NOYW1lID0gJ29wZW5ob3Vycy10aW1lJztcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmV2aWV3cykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgaWYgKHJldmlld3MubGVuZ3RoID09PSAwKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jldmlldy1uYW1lJztcbiAgbmFtZS50aXRsZSA9IFwicmV2aWV3ZXIncyBuYW1lXCI7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tdXMnLCBvcHRpb25zKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBjcmVhdGVkQXQ7XG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlldy1kYXRlJztcbiAgZGF0ZS50aXRsZSA9ICdkYXRlIHdoZW4gcmV2aWV3IHdhcyBwb3N0ZWQnO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICdyZXZpZXctcmF0aW5nJztcbiAgcmF0aW5nLnRpdGxlID0gJ2dpdmVuIHJhdGluZyc7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgY29tbWVudHMuY2xhc3NOYW1lID0gJ3Jldmlldy1jb21tZW50cyc7XG4gIGNvbW1lbnRzLnRpdGxlID0gJ2NvbW1lbnRzIGZyb20gdGhlIHJldmlld2VyJztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn1cblxuLyoqXG4gKiAgQ3JlYXRlIGEgSFRNTCBzdWJtaXQgZm9ybSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsU3VibWl0UmV2aWV3Rm9ybUhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcblxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gIGZvcm0uaWQgPSAnZm9ybS1yZXZpZXcnO1xuICBmb3JtLm1ldGhvZCA9ICdQT1NUJztcbiAgZm9ybS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQWRkIHJldmlldyBmb3IgcmVzdGF1cmFudCcpO1xuXG4gIGNvbnN0IHJlc3RhdXJhbnRJRCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIHJlc3RhdXJhbnRJRC5pZCA9ICdyZXN0YXVyYW50X2lkJztcbiAgcmVzdGF1cmFudElELm5hbWUgPSAncmVzdGF1cmFudF9pZCc7XG4gIHJlc3RhdXJhbnRJRC50eXBlID0gJ2hpZGRlbic7XG4gIHJlc3RhdXJhbnRJRC52YWx1ZSA9IHJlc3RhdXJhbnQuaWQ7XG4gIGZvcm0uYXBwZW5kQ2hpbGQocmVzdGF1cmFudElEKTtcblxuICBjb25zdCBuYW1lU2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWVTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBjb25zdCBuYW1lTGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgbmFtZUxibC5pbm5lckhUTUwgPSAnKiBOYW1lOic7XG4gIG5hbWVMYmwuZm9yID0gJ3VOYW1lJztcbiAgbmFtZUxibC50aXRsZSA9IFwicmV2aWV3ZXIncyBuYW1lXCI7XG4gIG5hbWVTaGVsbC5hcHBlbmRDaGlsZChuYW1lTGJsKTtcblxuICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBuYW1lSW5wdXQuaWQgPSAndU5hbWUnO1xuICBuYW1lSW5wdXQubmFtZSA9ICduYW1lJ1xuICBuYW1lSW5wdXQucGxhY2Vob2xkZXIgPSAnWW91ciBOYW1lJztcbiAgbmFtZUlucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1yZXF1aXJlZCcsICd0cnVlJylcbiAgbmFtZUlucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdZb3VyIG5hbWUnKTtcbiAgbmFtZUxibC5hcHBlbmRDaGlsZChuYW1lSW5wdXQpO1xuICBmb3JtLmFwcGVuZENoaWxkKG5hbWVTaGVsbCk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLXVzJywgb3B0aW9ucyk7XG4gIGRhdGUuaW5uZXJIVE1MID0gbm93O1xuICBkYXRlLmNsYXNzTmFtZSA9ICdyZXZpZXctZGF0ZSc7XG4gIGRhdGUudGl0bGUgPSAnZGF0ZSB3aGVuIHJldmlldyBpcyBwb3N0ZWQnO1xuICBmb3JtLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIGNvbnN0IHJhdGluZ1NoZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmdTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LXJhdGluZyc7XG4gIGNvbnN0IHJhdGluZ0xibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHJhdGluZ0xibC5pbm5lckhUTUwgPSAnUmF0aW5nOic7XG4gIGNvbnN0IHJhdGluZ09wdGlvbnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTtcbiAgcmF0aW5nT3B0aW9ucy5uYW1lID0gJ3JhdGluZyc7XG4gIGZvciAodmFyIGkgPSAxOyBpIDw9IDU7IGkrKykge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi52YWx1ZSA9IGk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGk7XG4gICAgcmF0aW5nT3B0aW9ucy5hcHBlbmRDaGlsZChvcHRpb24pO1xuICB9XG4gIHJhdGluZ0xibC5hcHBlbmRDaGlsZChyYXRpbmdPcHRpb25zKTtcbiAgcmF0aW5nU2hlbGwuYXBwZW5kQ2hpbGQocmF0aW5nTGJsKTtcbiAgZm9ybS5hcHBlbmRDaGlsZChyYXRpbmdTaGVsbCk7XG5cbiAgY29uc3QgY29tbWVudHNTaGVsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHNTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LWNvbW1lbnRzJztcbiAgY29uc3QgY29tbWVudHNMYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICBjb21tZW50c0xibC5pbm5lckhUTUwgPSAnKiBDb21tZW50czonO1xuICBjb25zdCBjb21tZW50c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICBjb21tZW50c1RleHQubmFtZSA9ICdjb21tZW50cyc7XG4gIGNvbW1lbnRzVGV4dC5pZCA9ICdjb21tZW50c1RleHQnO1xuICBjb21tZW50c1RleHQuc2V0QXR0cmlidXRlKCdhcmlhLXJlcXVpcmVkJywgJ3RydWUnKVxuICBjb21tZW50c1RleHQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0FkZGl0aW9uYWwgY29tbWVudHMgZm9yIHRoZSByZXZpZXcnKTtcbiAgY29tbWVudHNTaGVsbC5hcHBlbmRDaGlsZChjb21tZW50c0xibCk7XG4gIGNvbW1lbnRzU2hlbGwuYXBwZW5kQ2hpbGQoY29tbWVudHNUZXh0KTtcbiAgZm9ybS5hcHBlbmRDaGlsZChjb21tZW50c1NoZWxsKTtcblxuICBjb25zdCBzdWJtaXRTaGVsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgc3VibWl0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIHN1Ym1pdEJ0bi5pZCA9ICdzdWJtaXRCdG4nO1xuICBzdWJtaXRCdG4udHlwZSA9ICdzdWJtaXQnO1xuICBzdWJtaXRCdG4uaW5uZXJIVE1MID0gJ1N1Ym1pdCBSZXZpZXchJztcbiAgc3VibWl0QnRuLnZhbHVlID0gJ1N1Ym1pdCc7XG4gIHN1Ym1pdEJ0bi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnU3VibWl0IHJldmlldycpO1xuICBzdWJtaXRTaGVsbC5hcHBlbmRDaGlsZChzdWJtaXRCdG4pO1xuICBmb3JtLmFwcGVuZENoaWxkKHN1Ym1pdFNoZWxsKTtcblxuICBsaS5hcHBlbmRDaGlsZChmb3JtKTtcbiAgdWwuYXBwZW5kQ2hpbGQobGkpO1xuXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgc3VibWl0UmV2aWV3KGZvcm0pO1xuICB9KTtcbn1cblxuLyoqXG4qIFN1Ym1pdCByZXZpZXdzIHRob3VnaCBqYXZhc2NyaXB0LlxuKi9cbnN1Ym1pdFJldmlldyA9IChmb3JtKSA9PiB7XG4gIC8vIEJpbmQgdGhlIEZvcm1EYXRhIG9iamVjdCBhbmQgdGhlIGZvcm0gZWxlbWVudFxuICBjb25zdCBGRCA9IG5ldyBGb3JtRGF0YShmb3JtKTtcblxuICBjb25zdCByZXZpZXcgPSB7fTtcbiAgbGV0IGJhZERhdGEgPSBmYWxzZTtcbiAgRkQuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgY29uc3Qgc2FmZVN0ciA9IGVzY2FwZSh2YWx1ZSk7XG4gICAgaWYgKHNhZmVTdHIgPT09ICcnKSB7XG4gICAgICBzaG93Tm90aWZpY2F0aW9uKGBPaCBubyEgU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSBjaGVjayAke2tleX0gZmllbGRgKTtcbiAgICAgIGJhZERhdGEgPSB0cnVlO1xuICAgIH1cbiAgICByZXZpZXdba2V5XSA9IHNhZmVTdHI7XG4gIH0pO1xuXG4gIHJldmlldy5yZXN0YXVyYW50X2lkID0gcGFyc2VJbnQocmV2aWV3LnJlc3RhdXJhbnRfaWQpO1xuICByZXZpZXcucmF0aW5nID0gcGFyc2VJbnQocmV2aWV3LnJhdGluZyk7XG5cbiAgLy8gZG9uJ3QgcG9zdCBiYWRseSBmb3JtZWQgcmV2aWV3c1xuICBpZiAoYmFkRGF0YSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCB1bCA9IGZvcm0ucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICByZXZpZXdbJ2NyZWF0ZWRBdCddID0gbm93O1xuICBEQkhlbHBlci5fdXBkYXRlREIoJ25ld1InLCByZXZpZXcpO1xuICBEQkhlbHBlci5fdXBkYXRlREIoJ3Jldmlld3MnLCByZXZpZXcpO1xuXG4gIGxldCByZXZpZXdOb2RlID0gY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpO1xuXG4gIHJldHVybiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeS50aGVuKHJlZyA9PiB7XG4gICAgcmV0dXJuIHJlZy5zeW5jLnJlZ2lzdGVyKCdzZW5kLXJldmlld3MnKVxuICB9KS50aGVuKCgpID0+IHtcbiAgICBzaG93Tm90aWZpY2F0aW9uKCdZb3VyIHJldmlldyB3aWxsIGJlIHBvc3RlZCBhcyBzb29uIGFzIHBvc3NpYmxlLicpO1xuICAgIHVsLmluc2VydEJlZm9yZShyZXZpZXdOb2RlLCBmb3JtLnBhcmVudE5vZGUpO1xuICAgIHVsLnJlbW92ZUNoaWxkKGZvcm0ucGFyZW50Tm9kZSk7XG4gIH0pLmNhdGNoKCgpID0+IHtcbiAgICBzaG93Tm90aWZpY2F0aW9uKCdFcnJvcicpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5maWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50JywgJ3BhZ2UnKVxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xufVxuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKVxuICAgIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pXG4gICAgcmV0dXJuICcnO1xuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufVxuIl19
