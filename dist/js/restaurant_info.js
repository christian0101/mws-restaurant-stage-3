let restaurant,reviews;var map;document.addEventListener("DOMContentLoaded",e=>{DBHelper.registerServiceWorker(),this._toastsView=new Toast,fetchRestaurantFromURL()}),window.initMap=(()=>{self.restaurant&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))}),fetchRestaurantFromURL=(()=>{if(self.restaurant)return;const e=getParameterByName("id");e?DBHelper.fetchDataById("restaurants",e,(t,n)=>{self.restaurant=n,!t||n?DBHelper.fetchReviewsByRestaurantId(e,(e,t)=>{self.reviews=t.reverse(),e&&showNotification(e),fillRestaurantHTML(),Helper.lazyLoad()}):showNotification(t)}):showNotification("No restaurant id in URL")}),fillRestaurantHTML=((e=self.restaurant)=>{fillBreadcrumb();const t=document.getElementsByTagName("head")[0],n=document.createElement("meta");n.setAttribute("name","description"),n.setAttribute("content",`Detailed information about ${e.name}`),t.append(n);const a=document.getElementById("restaurant-name");a.innerHTML=e.name,a.title="restaurant name";const r=document.createElement("input");r.type="checkbox",r.name="favourite",r.value="favourite",r.id="favourite",r.checked=e.is_favorite,r.setAttribute("onchange","updateIsFavourite()");const i=document.createElement("label");i.setAttribute("for","favourite"),a.appendChild(r),a.appendChild(i);const s=document.getElementById("restaurant-address");s.innerHTML=e.address,s.title="restaurant address";const o=DBHelper.imageUrlForRestaurant(e,!0),c=document.getElementById("restaurant-img");c.className="restaurant-img",c.classList.add("lazy"),c.src=o,c.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),c.setAttribute("data-srcset",DBHelper.imageSRCSetUrlsForRestaurant(e,["1x","2x"])),c.alt=e.photograph?DBHelper.getPhotoDescription(e):"no picture found";const l=document.getElementById("restaurant-cuisine");l.innerHTML=e.cuisine_type,l.title="restaurant cuisine type",e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),updateIsFavourite=((e=self.restaurant)=>{const t=e.is_favorite?0:1,n=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"}),a={restaurant_id:parseInt(e.id),is_favorite:parseInt(t),createdAt:n};sendData(a).then(e=>{saveLocally()})}),sendData=(e=>DBHelper._updateDB("newIsFavourite",e).then(()=>navigator.serviceWorker.ready).then(e=>e.sync.register("send-isFavourite")).then(()=>{showNotification(`Restaurant is ${e.is_favorite?"favourite now :)":"not favourite anymore :("}`)}).catch(()=>{showNotification("Oops! Something went wrong. :(")})),saveLocally=((e=self.restaurant)=>(e.is_favorite=!e.is_favorite,DBHelper._updateDB("restaurants",e).then(()=>{console.log("updated local copy")}))),showNotification=((e,t={buttons:["dismiss"]})=>{this._toastsView.create(e,t)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.className="openhours-day",a.appendChild(r);const i=document.createElement("td");i.innerHTML=e[n],i.className="openhours-time",a.appendChild(i),t.appendChild(a)}}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list"),a=document.createElement("h3");if(a.innerHTML="Reviews",t.insertBefore(a,n),fillSubmitReviewFormHTML(n),0===e.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}e.forEach(e=>{n.appendChild(createReviewHTML(e))})}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,n.className="review-name",n.title="reviewer's name",t.appendChild(n);const a=document.createElement("p"),r=new Date(e.createdAt).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});a.innerHTML=r,a.className="review-date",a.title="date when review was posted",t.appendChild(a);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,i.className="review-rating",i.title="given rating",t.appendChild(i);const s=document.createElement("p");return s.innerHTML=e.comments,s.className="review-comments",s.title="comments from the reviewer",t.appendChild(s),t}),fillSubmitReviewFormHTML=((e,t=self.restaurant)=>{const n=document.createElement("li"),a=document.createElement("form");a.id="form-review",a.method="POST",a.setAttribute("aria-label","Add review for restaurant");const r=document.createElement("input");r.id="restaurant_id",r.name="restaurant_id",r.type="hidden",r.value=t.id,a.appendChild(r);const i=document.createElement("p");i.className="review-name";const s=document.createElement("label");s.innerHTML="* Name:",s.for="uName",s.title="reviewer's name",i.appendChild(s);const o=document.createElement("input");o.id="uName",o.name="name",o.placeholder="Your Name",o.setAttribute("aria-required","true"),o.setAttribute("aria-label","Your name"),s.appendChild(o),a.appendChild(i);const c=document.createElement("p"),l=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});c.innerHTML=l,c.className="review-date",c.title="date when review is posted",a.appendChild(c);const d=document.createElement("p");d.className="review-rating";const m=document.createElement("label");m.innerHTML="Rating:";const u=document.createElement("select");u.name="rating";for(var p=1;p<=5;p++){const e=document.createElement("option");e.value=p,e.innerHTML=p,u.appendChild(e)}m.appendChild(u),d.appendChild(m),a.appendChild(d);const h=document.createElement("p");h.className="review-comments";const v=document.createElement("label");v.innerHTML="* Comments:";const f=document.createElement("textarea");f.name="comments",f.id="commentsText",f.setAttribute("aria-required","true"),f.setAttribute("aria-label","Additional comments for the review"),h.appendChild(v),h.appendChild(f),a.appendChild(h);const w=document.createElement("p"),g=document.createElement("button");g.id="submitBtn",g.type="submit",g.innerHTML="Submit Review!",g.value="Submit",g.setAttribute("aria-label","Submit review"),w.appendChild(g),a.appendChild(w),n.appendChild(a),e.appendChild(n),a.addEventListener("submit",function(e){e.preventDefault(),submitReview(a)})}),submitReview=(e=>{const t=new FormData(e),n={};let a=!1;if(t.forEach(function(e,t){const r=escape(e);""===r&&(showNotification(`Oh no! Something went wrong, please check ${t} field`),a=!0),n[t]=r}),n.restaurant_id=parseInt(n.restaurant_id),n.rating=parseInt(n.rating),a)return;let r=e.parentNode.parentNode;const i=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});n.createdAt=i,DBHelper._updateDB("newR",n),DBHelper._updateDB("reviews",n),n.name=unescape(n.name),n.comments=unescape(n.comments);let s=createReviewHTML(n);return navigator.serviceWorker.ready.then(e=>e.sync.register("send-reviews")).then(()=>{showNotification("Your review will be posted as soon as possible."),r.insertBefore(s,e.parentNode),r.removeChild(e.parentNode)}).catch(()=>{showNotification("Error")})}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.setAttribute("aria-current","page"),n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm1hcCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiREJIZWxwZXIiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJ0aGlzIiwiX3RvYXN0c1ZpZXciLCJUb2FzdCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJ3aW5kb3ciLCJpbml0TWFwIiwic2VsZiIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJnZXRFbGVtZW50QnlJZCIsInpvb20iLCJjZW50ZXIiLCJsYXRsbmciLCJzY3JvbGx3aGVlbCIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJpZCIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoRGF0YUJ5SWQiLCJlcnJvciIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkIiwicmV2ZXJzZSIsInNob3dOb3RpZmljYXRpb24iLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJIZWxwZXIiLCJsYXp5TG9hZCIsImZpbGxCcmVhZGNydW1iIiwiaGVhZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZGVzY3JpcHRpb24iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwibmFtZSIsImFwcGVuZCIsImlubmVySFRNTCIsInRpdGxlIiwiZmF2b3VyaXRlVG9nZ2xlIiwidHlwZSIsInZhbHVlIiwiY2hlY2tlZCIsImlzX2Zhdm9yaXRlIiwidG9nZ2xlTGJsIiwiYXBwZW5kQ2hpbGQiLCJhZGRyZXNzIiwiaW1nU3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJhZGQiLCJzcmMiLCJpbWFnZVNSQ1NldFVybHNGb3JSZXN0YXVyYW50IiwiYWx0IiwiZ2V0UGhvdG9EZXNjcmlwdGlvbiIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsInVwZGF0ZUlzRmF2b3VyaXRlIiwibm93IiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIm1vbnRoIiwiZGF5IiwieWVhciIsImlzRmF2b3VyaXRlIiwicmVzdGF1cmFudF9pZCIsInBhcnNlSW50IiwiY3JlYXRlZEF0Iiwic2VuZERhdGEiLCJ0aGVuIiwiYSIsInNhdmVMb2NhbGx5IiwiZGF0YSIsIl91cGRhdGVEQiIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWFkeSIsInJlZyIsInN5bmMiLCJyZWdpc3RlciIsImNhdGNoIiwiY29uc29sZSIsImxvZyIsIm1zZyIsIm9wdGlvbnMiLCJidXR0b25zIiwiY3JlYXRlIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsInRpbWUiLCJjb250YWluZXIiLCJ1bCIsImluc2VydEJlZm9yZSIsImZpbGxTdWJtaXRSZXZpZXdGb3JtSFRNTCIsImxlbmd0aCIsIm5vUmV2aWV3cyIsImZvckVhY2giLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwibGkiLCJkYXRlIiwicmF0aW5nIiwiY29tbWVudHMiLCJmb3JtIiwibWV0aG9kIiwicmVzdGF1cmFudElEIiwibmFtZVNoZWxsIiwibmFtZUxibCIsImZvciIsIm5hbWVJbnB1dCIsInBsYWNlaG9sZGVyIiwicmF0aW5nU2hlbGwiLCJyYXRpbmdMYmwiLCJyYXRpbmdPcHRpb25zIiwiaSIsIm9wdGlvbiIsImNvbW1lbnRzU2hlbGwiLCJjb21tZW50c0xibCIsImNvbW1lbnRzVGV4dCIsInN1Ym1pdFNoZWxsIiwic3VibWl0QnRuIiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRSZXZpZXciLCJGRCIsIkZvcm1EYXRhIiwiYmFkRGF0YSIsInNhZmVTdHIiLCJlc2NhcGUiLCJwYXJlbnROb2RlIiwidW5lc2NhcGUiLCJyZXZpZXdOb2RlIiwicmVtb3ZlQ2hpbGQiLCJicmVhZGNydW1iIiwidXJsIiwibG9jYXRpb24iLCJo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QSxFQUFNckksT0FBT3NJLFNBQVNDLE1BQ3hCM0csRUFBT0EsRUFBSzRHLFFBQVEsVUFBVyxRQUMvQixNQUNFQyxFQURZLElBQUlDLGNBQWM5RyxzQkFDZCtHLEtBQUtOLEdBQ3ZCLE9BQUtJLEVBRUFBLEVBQVEsR0FFTkcsbUJBQW1CSCxFQUFRLEdBQUdELFFBQVEsTUFBTyxNQUQzQyxHQUZBIiwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50LCByZXZpZXdzO1xudmFyIG1hcDtcblxuLyoqXG4gKiBGZXRjaCBkYXRhIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4gIERCSGVscGVyLnJlZ2lzdGVyU2VydmljZVdvcmtlcigpO1xuICB0aGlzLl90b2FzdHNWaWV3ID0gbmV3IFRvYXN0KCk7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKTtcbn0pO1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHtcbiAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgICB6b29tOiAxNixcbiAgICAgIGNlbnRlcjogc2VsZi5yZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICAgIH0pO1xuICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgLy9jYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICBpZiAoIWlkKSB7XG4gICAgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgc2hvd05vdGlmaWNhdGlvbignTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnKTtcbiAgICByZXR1cm47XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hEYXRhQnlJZCgncmVzdGF1cmFudHMnLCBpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKGVycm9yICYmICFyZXN0YXVyYW50KSB7XG4gICAgICAgIHNob3dOb3RpZmljYXRpb24oZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIERCSGVscGVyLmZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkKGlkLCAoZXJyb3IsIHJldmlld3MpID0+IHtcbiAgICAgICAgc2VsZi5yZXZpZXdzID0gcmV2aWV3cy5yZXZlcnNlKCk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oZXJyb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICAgIEhlbHBlci5sYXp5TG9hZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBmaWxsQnJlYWRjcnVtYigpO1xuXG4gIGNvbnN0IGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdO1xuICBjb25zdCBkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ21ldGEnKTtcbiAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKCduYW1lJywgJ2Rlc2NyaXB0aW9uJyk7XG4gIGRlc2NyaXB0aW9uLnNldEF0dHJpYnV0ZSgnY29udGVudCcsIGBEZXRhaWxlZCBpbmZvcm1hdGlvbiBhYm91dCAke3Jlc3RhdXJhbnQubmFtZX1gKTtcbiAgaGVhZC5hcHBlbmQoZGVzY3JpcHRpb24pO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBuYW1lLnRpdGxlID0gJ3Jlc3RhdXJhbnQgbmFtZSc7XG4gIGNvbnN0IGZhdm91cml0ZVRvZ2dsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGZhdm91cml0ZVRvZ2dsZS50eXBlID0gJ2NoZWNrYm94JztcbiAgZmF2b3VyaXRlVG9nZ2xlLm5hbWUgPSAnZmF2b3VyaXRlJztcbiAgZmF2b3VyaXRlVG9nZ2xlLnZhbHVlID0gJ2Zhdm91cml0ZSc7XG4gIGZhdm91cml0ZVRvZ2dsZS5pZCA9ICdmYXZvdXJpdGUnO1xuICBmYXZvdXJpdGVUb2dnbGUuY2hlY2tlZCA9IHJlc3RhdXJhbnQuaXNfZmF2b3JpdGU7XG4gIGZhdm91cml0ZVRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ29uY2hhbmdlJywgJ3VwZGF0ZUlzRmF2b3VyaXRlKCknKTtcbiAgY29uc3QgdG9nZ2xlTGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgdG9nZ2xlTGJsLnNldEF0dHJpYnV0ZSgnZm9yJywgJ2Zhdm91cml0ZScpO1xuICBuYW1lLmFwcGVuZENoaWxkKGZhdm91cml0ZVRvZ2dsZSk7XG4gIG5hbWUuYXBwZW5kQ2hpbGQodG9nZ2xlTGJsKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgYWRkcmVzcy50aXRsZSA9ICdyZXN0YXVyYW50IGFkZHJlc3MnO1xuXG4gIGNvbnN0IGltZ1NyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB0cnVlKTtcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2UuY2xhc3NMaXN0LmFkZCgnbGF6eScpO1xuICBpbWFnZS5zcmMgPSBpbWdTcmM7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3Jjc2V0JywgREJIZWxwZXIuaW1hZ2VTUkNTZXRVcmxzRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBbJzF4JywgJzJ4J10pKTtcbiAgaW1hZ2UuYWx0ID0gKHJlc3RhdXJhbnQucGhvdG9ncmFwaCkgPyBEQkhlbHBlci5nZXRQaG90b0Rlc2NyaXB0aW9uKHJlc3RhdXJhbnQpIDpcbiAgJ25vIHBpY3R1cmUgZm91bmQnO1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG4gIGN1aXNpbmUudGl0bGUgPSAncmVzdGF1cmFudCBjdWlzaW5lIHR5cGUnO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cbiAgLy8gZmlsbCByZXZpZXdzXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xufVxuXG4vKipcbiAqIEhhZGxlIGZhdm91cml0ZSB0b2dnbGVcbiAqL1xuIHVwZGF0ZUlzRmF2b3VyaXRlID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgIGNvbnN0IGlzX2Zhdm9yaXRlID0gKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpID8gMCA6IDE7XG5cbiAgIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tdXMnLCBvcHRpb25zKTtcbiAgIGNvbnN0IGlzRmF2b3VyaXRlID0ge1xuICAgICBcInJlc3RhdXJhbnRfaWRcIjogcGFyc2VJbnQocmVzdGF1cmFudC5pZCksXG4gICAgIFwiaXNfZmF2b3JpdGVcIjogcGFyc2VJbnQoaXNfZmF2b3JpdGUpLFxuICAgICBcImNyZWF0ZWRBdFwiOiBub3dcbiAgIH1cblxuICAgc2VuZERhdGEoaXNGYXZvdXJpdGUpLnRoZW4oKGEpID0+IHtcbiAgICAgc2F2ZUxvY2FsbHkoKVxuICAgfSk7XG4gfVxuXG4vKipcbiAqIFNlbmQgZGF0YVxuICovXG4gc2VuZERhdGEgPSAoZGF0YSkgPT4ge1xuICByZXR1cm4gREJIZWxwZXIuX3VwZGF0ZURCKCduZXdJc0Zhdm91cml0ZScsIGRhdGEpLnRoZW4oKCkgPT4ge1xuICAgIC8vIFdhaXQgZm9yIHRoZSBzY29wZWQgc2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uIHRvIGdldCBhXG4gICAgLy8gc2VydmljZSB3b3JrZXIgd2l0aCBhbiBhY3RpdmUgc3RhdGVcbiAgICByZXR1cm4gbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7XG4gIH0pLnRoZW4ocmVnID0+IHtcbiAgICByZXR1cm4gcmVnLnN5bmMucmVnaXN0ZXIoJ3NlbmQtaXNGYXZvdXJpdGUnKTtcbiAgfSkudGhlbigoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbihgUmVzdGF1cmFudCBpcyAkeyhkYXRhLmlzX2Zhdm9yaXRlKSA/ICdmYXZvdXJpdGUgbm93IDopJyA6ICdub3QgZmF2b3VyaXRlIGFueW1vcmUgOignfWApO1xuICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignT29wcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuIDooJyk7XG4gIH0pO1xufVxuXG5zYXZlTG9jYWxseSA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSAhcmVzdGF1cmFudC5pc19mYXZvcml0ZTtcbiAgcmV0dXJuIERCSGVscGVyLl91cGRhdGVEQigncmVzdGF1cmFudHMnLCByZXN0YXVyYW50KS50aGVuKCgpID0+IHtcbiAgICBjb25zb2xlLmxvZygndXBkYXRlZCBsb2NhbCBjb3B5Jyk7XG4gIH0pO1xufVxuXG4vKipcbiAqIERpc3BsYXkgbm90aWZpY2F0aW9ucy5cbiAqL1xuc2hvd05vdGlmaWNhdGlvbiA9IChtc2csIG9wdGlvbnMgPSB7YnV0dG9uczogWydkaXNtaXNzJ119KSA9PiB7XG4gIHRoaXMuX3RvYXN0c1ZpZXcuY3JlYXRlKG1zZywgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICBkYXkuY2xhc3NOYW1lID0gJ29wZW5ob3Vycy1kYXknO1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHRpbWUuY2xhc3NOYW1lID0gJ29wZW5ob3Vycy10aW1lJztcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmV2aWV3cykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKHRpdGxlLCB1bCk7XG5cbiAgZmlsbFN1Ym1pdFJldmlld0Zvcm1IVE1MKHVsKTtcblxuICBpZiAocmV2aWV3cy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jldmlldy1uYW1lJztcbiAgbmFtZS50aXRsZSA9IFwicmV2aWV3ZXIncyBuYW1lXCI7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tdXMnLCBvcHRpb25zKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBjcmVhdGVkQXQ7XG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlldy1kYXRlJztcbiAgZGF0ZS50aXRsZSA9ICdkYXRlIHdoZW4gcmV2aWV3IHdhcyBwb3N0ZWQnO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICdyZXZpZXctcmF0aW5nJztcbiAgcmF0aW5nLnRpdGxlID0gJ2dpdmVuIHJhdGluZyc7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgY29tbWVudHMuY2xhc3NOYW1lID0gJ3Jldmlldy1jb21tZW50cyc7XG4gIGNvbW1lbnRzLnRpdGxlID0gJ2NvbW1lbnRzIGZyb20gdGhlIHJldmlld2VyJztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn1cblxuLyoqXG4gKiAgQ3JlYXRlIGEgSFRNTCBzdWJtaXQgZm9ybSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsU3VibWl0UmV2aWV3Rm9ybUhUTUwgPSAodWwsIHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpO1xuICBmb3JtLmlkID0gJ2Zvcm0tcmV2aWV3JztcbiAgZm9ybS5tZXRob2QgPSAnUE9TVCc7XG4gIGZvcm0uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0FkZCByZXZpZXcgZm9yIHJlc3RhdXJhbnQnKTtcblxuICBjb25zdCByZXN0YXVyYW50SUQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICByZXN0YXVyYW50SUQuaWQgPSAncmVzdGF1cmFudF9pZCc7XG4gIHJlc3RhdXJhbnRJRC5uYW1lID0gJ3Jlc3RhdXJhbnRfaWQnO1xuICByZXN0YXVyYW50SUQudHlwZSA9ICdoaWRkZW4nO1xuICByZXN0YXVyYW50SUQudmFsdWUgPSByZXN0YXVyYW50LmlkO1xuICBmb3JtLmFwcGVuZENoaWxkKHJlc3RhdXJhbnRJRCk7XG5cbiAgY29uc3QgbmFtZVNoZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lU2hlbGwuY2xhc3NOYW1lID0gJ3Jldmlldy1uYW1lJztcbiAgY29uc3QgbmFtZUxibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIG5hbWVMYmwuaW5uZXJIVE1MID0gJyogTmFtZTonO1xuICBuYW1lTGJsLmZvciA9ICd1TmFtZSc7XG4gIG5hbWVMYmwudGl0bGUgPSBcInJldmlld2VyJ3MgbmFtZVwiO1xuICBuYW1lU2hlbGwuYXBwZW5kQ2hpbGQobmFtZUxibCk7XG5cbiAgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgbmFtZUlucHV0LmlkID0gJ3VOYW1lJztcbiAgbmFtZUlucHV0Lm5hbWUgPSAnbmFtZSdcbiAgbmFtZUlucHV0LnBsYWNlaG9sZGVyID0gJ1lvdXIgTmFtZSc7XG4gIG5hbWVJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtcmVxdWlyZWQnLCAndHJ1ZScpXG4gIG5hbWVJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnWW91ciBuYW1lJyk7XG4gIG5hbWVMYmwuYXBwZW5kQ2hpbGQobmFtZUlucHV0KTtcbiAgZm9ybS5hcHBlbmRDaGlsZChuYW1lU2hlbGwpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICBkYXRlLmlubmVySFRNTCA9IG5vdztcbiAgZGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3LWRhdGUnO1xuICBkYXRlLnRpdGxlID0gJ2RhdGUgd2hlbiByZXZpZXcgaXMgcG9zdGVkJztcbiAgZm9ybS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmdTaGVsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nU2hlbGwuY2xhc3NOYW1lID0gJ3Jldmlldy1yYXRpbmcnO1xuICBjb25zdCByYXRpbmdMYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICByYXRpbmdMYmwuaW5uZXJIVE1MID0gJ1JhdGluZzonO1xuICBjb25zdCByYXRpbmdPcHRpb25zID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7XG4gIHJhdGluZ09wdGlvbnMubmFtZSA9ICdyYXRpbmcnO1xuICBmb3IgKHZhciBpID0gMTsgaSA8PSA1OyBpKyspIHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24udmFsdWUgPSBpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBpO1xuICAgIHJhdGluZ09wdGlvbnMuYXBwZW5kQ2hpbGQob3B0aW9uKTtcbiAgfVxuICByYXRpbmdMYmwuYXBwZW5kQ2hpbGQocmF0aW5nT3B0aW9ucyk7XG4gIHJhdGluZ1NoZWxsLmFwcGVuZENoaWxkKHJhdGluZ0xibCk7XG4gIGZvcm0uYXBwZW5kQ2hpbGQocmF0aW5nU2hlbGwpO1xuXG4gIGNvbnN0IGNvbW1lbnRzU2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzU2hlbGwuY2xhc3NOYW1lID0gJ3Jldmlldy1jb21tZW50cyc7XG4gIGNvbnN0IGNvbW1lbnRzTGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgY29tbWVudHNMYmwuaW5uZXJIVE1MID0gJyogQ29tbWVudHM6JztcbiAgY29uc3QgY29tbWVudHNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgY29tbWVudHNUZXh0Lm5hbWUgPSAnY29tbWVudHMnO1xuICBjb21tZW50c1RleHQuaWQgPSAnY29tbWVudHNUZXh0JztcbiAgY29tbWVudHNUZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1yZXF1aXJlZCcsICd0cnVlJylcbiAgY29tbWVudHNUZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdBZGRpdGlvbmFsIGNvbW1lbnRzIGZvciB0aGUgcmV2aWV3Jyk7XG4gIGNvbW1lbnRzU2hlbGwuYXBwZW5kQ2hpbGQoY29tbWVudHNMYmwpO1xuICBjb21tZW50c1NoZWxsLmFwcGVuZENoaWxkKGNvbW1lbnRzVGV4dCk7XG4gIGZvcm0uYXBwZW5kQ2hpbGQoY29tbWVudHNTaGVsbCk7XG5cbiAgY29uc3Qgc3VibWl0U2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBzdWJtaXRCdG4uaWQgPSAnc3VibWl0QnRuJztcbiAgc3VibWl0QnRuLnR5cGUgPSAnc3VibWl0JztcbiAgc3VibWl0QnRuLmlubmVySFRNTCA9ICdTdWJtaXQgUmV2aWV3ISc7XG4gIHN1Ym1pdEJ0bi52YWx1ZSA9ICdTdWJtaXQnO1xuICBzdWJtaXRCdG4uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1N1Ym1pdCByZXZpZXcnKTtcbiAgc3VibWl0U2hlbGwuYXBwZW5kQ2hpbGQoc3VibWl0QnRuKTtcbiAgZm9ybS5hcHBlbmRDaGlsZChzdWJtaXRTaGVsbCk7XG5cbiAgbGkuYXBwZW5kQ2hpbGQoZm9ybSk7XG4gIHVsLmFwcGVuZENoaWxkKGxpKTtcblxuICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIHN1Ym1pdFJldmlldyhmb3JtKTtcbiAgfSk7XG59XG5cbi8qKlxuKiBTdWJtaXQgcmV2aWV3cyB0aG91Z2ggamF2YXNjcmlwdC5cbiovXG5zdWJtaXRSZXZpZXcgPSAoZm9ybSkgPT4ge1xuICAvLyBCaW5kIHRoZSBGb3JtRGF0YSBvYmplY3QgYW5kIHRoZSBmb3JtIGVsZW1lbnRcbiAgY29uc3QgRkQgPSBuZXcgRm9ybURhdGEoZm9ybSk7XG5cbiAgY29uc3QgcmV2aWV3ID0ge307XG4gIGxldCBiYWREYXRhID0gZmFsc2U7XG4gIEZELmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgIGNvbnN0IHNhZmVTdHIgPSBlc2NhcGUodmFsdWUpO1xuICAgIGlmIChzYWZlU3RyID09PSAnJykge1xuICAgICAgc2hvd05vdGlmaWNhdGlvbihgT2ggbm8hIFNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgY2hlY2sgJHtrZXl9IGZpZWxkYCk7XG4gICAgICBiYWREYXRhID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV2aWV3W2tleV0gPSBzYWZlU3RyO1xuICB9KTtcblxuICByZXZpZXcucmVzdGF1cmFudF9pZCA9IHBhcnNlSW50KHJldmlldy5yZXN0YXVyYW50X2lkKTtcbiAgcmV2aWV3LnJhdGluZyA9IHBhcnNlSW50KHJldmlldy5yYXRpbmcpO1xuXG4gIC8vIGRvbid0IHBvc3QgYmFkbHkgZm9ybWVkIHJldmlld3NcbiAgaWYgKGJhZERhdGEpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgdWwgPSBmb3JtLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICBjb25zdCBvcHRpb25zID0ge21vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnLCB5ZWFyOiAnbnVtZXJpYyd9O1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tdXMnLCBvcHRpb25zKTtcbiAgcmV2aWV3WydjcmVhdGVkQXQnXSA9IG5vdztcbiAgREJIZWxwZXIuX3VwZGF0ZURCKCduZXdSJywgcmV2aWV3KTtcbiAgREJIZWxwZXIuX3VwZGF0ZURCKCdyZXZpZXdzJywgcmV2aWV3KTtcblxuICByZXZpZXcubmFtZSA9IHVuZXNjYXBlKHJldmlldy5uYW1lKTtcbiAgcmV2aWV3LmNvbW1lbnRzID0gdW5lc2NhcGUocmV2aWV3LmNvbW1lbnRzKTtcbiAgbGV0IHJldmlld05vZGUgPSBjcmVhdGVSZXZpZXdIVE1MKHJldmlldyk7XG5cbiAgcmV0dXJuIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5LnRoZW4ocmVnID0+IHtcbiAgICByZXR1cm4gcmVnLnN5bmMucmVnaXN0ZXIoJ3NlbmQtcmV2aWV3cycpXG4gIH0pLnRoZW4oKCkgPT4ge1xuICAgIHNob3dOb3RpZmljYXRpb24oJ1lvdXIgcmV2aWV3IHdpbGwgYmUgcG9zdGVkIGFzIHNvb24gYXMgcG9zc2libGUuJyk7XG4gICAgdWwuaW5zZXJ0QmVmb3JlKHJldmlld05vZGUsIGZvcm0ucGFyZW50Tm9kZSk7XG4gICAgdWwucmVtb3ZlQ2hpbGQoZm9ybS5wYXJlbnROb2RlKTtcbiAgfSkuY2F0Y2goKCkgPT4ge1xuICAgIHNob3dOb3RpZmljYXRpb24oJ0Vycm9yJyk7XG4gIH0pO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuc2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnLCAncGFnZScpXG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpXG4gICAgcmV0dXJuIG51bGw7XG4gIGlmICghcmVzdWx0c1syXSlcbiAgICByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59XG4iXX0=
