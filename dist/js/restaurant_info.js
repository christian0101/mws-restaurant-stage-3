let restaurant,reviews;var map;document.addEventListener("DOMContentLoaded",e=>{DBHelper.registerServiceWorker(),this._dbPromise=DBHelper.openDatabase(),this._toastsView=new Toast,fetchRestaurantFromURL()}),showNotification=((e,t,n)=>{this._toastsView.create(e,t,n)}),window.initMap=(()=>{self.restaurant&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))}),fetchRestaurantFromURL=(()=>{if(self.restaurant)return;const e=getParameterByName("id");e?(DBHelper.fetchDataById("restaurants",e,this._dbPromise,(e,t,n)=>{self.restaurant=n,e?showNotification(e):(t&&showNotification(t),fillRestaurantHTML(),Helper.lazyLoad())}),DBHelper.fetchReviewsByRestaurantId(e,this._dbPromise,(e,t,n)=>{e?(showNotification(e),fillReviewsHTML()):t&&showNotification(t),resetReviews(n),fillReviewsHTML()})):showNotification("No restaurant id in URL")}),resetReviews=(e=>{self.reviews=[],document.getElementById("reviews-list").innerHTML="",self.reviews=e}),fillRestaurantHTML=((e=self.restaurant)=>{fillBreadcrumb();const t=document.getElementsByTagName("head")[0],n=document.createElement("meta");n.setAttribute("name","description"),n.setAttribute("content",`Detailed information about ${e.name}`),t.append(n);const a=document.getElementById("restaurant-name");a.innerHTML=e.name,a.title="restaurant name";const r=document.createElement("input");r.type="checkbox",r.name="favourite",r.value="favourite",r.id="favourite",r.checked=e.is_favorite,r.setAttribute("onchange","updateIsFavourite()");const i=document.createElement("label");i.setAttribute("for","favourite"),a.appendChild(r),a.appendChild(i);const s=document.getElementById("restaurant-address");s.innerHTML=e.address,s.title="restaurant address";const o=DBHelper.imageUrlForRestaurant(e,!0),l=document.getElementById("restaurant-img");l.className="restaurant-img",l.classList.add("lazy"),l.src=o,l.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),l.setAttribute("data-srcset",DBHelper.imageSRCSetUrlsForRestaurant(e,["1x","2x"])),l.alt=e.photograph?DBHelper.getPhotoDescription(e):"no picture found";const c=document.getElementById("restaurant-cuisine");c.innerHTML=e.cuisine_type,c.title="restaurant cuisine type",e.operating_hours&&fillRestaurantHoursHTML()}),updateIsFavourite=((e=self.restaurant)=>{const t=e.is_favorite?0:1,n=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"}),a={restaurant_id:e.id,is_favorite:parseInt(t),createdAt:n};sendData(a).then(e=>{saveLocally()})}),sendData=(e=>DBHelper._updateDB("newIsFavourite",e).then(()=>navigator.serviceWorker.ready).then(e=>e.sync.register("send-isFavourite")).then(()=>{showNotification(`Restaurant is ${e.is_favorite?"favourite now :)":"not favourite anymore :("}`,1.5)}).catch(()=>{showNotification("Oops! Something went wrong.",3)})),saveLocally=((e=self.restaurant)=>(e.is_favorite=!e.is_favorite,DBHelper._updateDB("restaurants",e).then(()=>{}))),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");t.innerHTML="";for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.className="openhours-day",a.appendChild(r);const i=document.createElement("td");i.innerHTML=e[n],i.className="openhours-time",a.appendChild(i),t.appendChild(a)}}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list");if(fillSubmitReviewFormHTML(n),0===e.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}e.forEach(e=>{n.appendChild(createReviewHTML(e))})}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,n.className="review-name",n.title="reviewer's name",t.appendChild(n);const a=document.createElement("p"),r=new Date(e.createdAt).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});a.innerHTML=r,a.className="review-date",a.title="date when review was posted",t.appendChild(a);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,i.className="review-rating",i.title="given rating",t.appendChild(i);const s=document.createElement("p");return s.innerHTML=e.comments,s.className="review-comments",s.title="comments from the reviewer",t.appendChild(s),t}),fillSubmitReviewFormHTML=((e,t=self.restaurant)=>{const n=document.createElement("li"),a=document.createElement("form");a.id="form-review",a.method="POST",a.setAttribute("aria-label","Add review for restaurant");const r=document.createElement("input");r.id="restaurant_id",r.name="restaurant_id",r.type="hidden",r.value=t.id,a.appendChild(r);const i=document.createElement("p");i.className="review-name";const s=document.createElement("label");s.innerHTML="*Name:",s.for="uName",s.title="reviewer's name",i.appendChild(s);const o=document.createElement("input");o.id="uName",o.name="name",o.placeholder="Your Name",o.setAttribute("aria-required","true"),o.setAttribute("aria-label","Your name"),s.appendChild(o),a.appendChild(i);const l=document.createElement("p"),c=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});l.innerHTML=c,l.className="review-date",l.title="date when review is posted",a.appendChild(l);const d=document.createElement("p");d.className="review-rating";const m=document.createElement("label");m.innerHTML="Rating:";const u=document.createElement("select");u.name="rating";for(var p=1;p<=5;p++){const e=document.createElement("option");e.value=p,e.innerHTML=p,u.appendChild(e)}m.appendChild(u),d.appendChild(m),a.appendChild(d);const h=document.createElement("p");h.className="review-comments";const w=document.createElement("label");w.innerHTML="*Comments:";const v=document.createElement("textarea");v.name="comments",v.id="commentsText",v.setAttribute("aria-required","true"),v.setAttribute("aria-label","Additional comments for the review"),h.appendChild(w),h.appendChild(v),a.appendChild(h);const f=document.createElement("p"),g=document.createElement("button");g.id="submitBtn",g.type="submit",g.innerHTML="Submit Review!",g.value="Submit",g.setAttribute("aria-label","Submit review"),f.appendChild(g),a.appendChild(f),n.appendChild(a),e.appendChild(n),a.addEventListener("submit",function(e){e.preventDefault(),submitReview(a)})}),submitReview=(e=>{const t=new FormData(e),n={};let a=!1;if(t.forEach(function(e,t){const r=escape(e);""===r&&(showNotification(`Oh no! Something went wrong, please check ${t} field`),a=!0),n[t]=r}),n.rating=parseInt(n.rating),a)return;let r=e.parentNode.parentNode;const i=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});n.createdAt=i,DBHelper._updateDB("newR",n),DBHelper._updateDB("reviews",n),n.name=unescape(n.name),n.comments=unescape(n.comments);let s=createReviewHTML(n);return navigator.serviceWorker.ready.then(e=>e.sync.register("send-reviews")).then(()=>{showNotification("Your review will be posted as soon as possible."),r.insertBefore(s,e.parentNode),r.removeChild(e.parentNode)}).catch(()=>{showNotification("Error")})}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb");resetBreadcrumb(t);const n=document.createElement("li");n.setAttribute("aria-current","page"),n.innerHTML=e.name,t.appendChild(n)}),resetBreadcrumb=(e=>{const t=e.children.length;for(let n=1;n<t;n++)e.removeChild(e.children.item(n))}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm1hcCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiREJIZWxwZXIiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJ0aGlzIiwiX2RiUHJvbWlzZSIsIm9wZW5EYXRhYmFzZSIsIl90b2FzdHNWaWV3IiwiVG9hc3QiLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwic2hvd05vdGlmaWNhdGlvbiIsIm1zZyIsImR1cmF0aW9uIiwib3B0aW9ucyIsImNyZWF0ZSIsIndpbmRvdyIsImluaXRNYXAiLCJzZWxmIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImlkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hEYXRhQnlJZCIsImVycm9yIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiSGVscGVyIiwibGF6eUxvYWQiLCJmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZCIsImZpbGxSZXZpZXdzSFRNTCIsInJlc2V0UmV2aWV3cyIsImlubmVySFRNTCIsImZpbGxCcmVhZGNydW1iIiwiaGVhZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZGVzY3JpcHRpb24iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwibmFtZSIsImFwcGVuZCIsInRpdGxlIiwiZmF2b3VyaXRlVG9nZ2xlIiwidHlwZSIsInZhbHVlIiwiY2hlY2tlZCIsImlzX2Zhdm9yaXRlIiwidG9nZ2xlTGJsIiwiYXBwZW5kQ2hpbGQiLCJhZGRyZXNzIiwiaW1nU3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJhZGQiLCJzcmMiLCJpbWFnZVNSQ1NldFVybHNGb3JSZXN0YXVyYW50IiwiYWx0IiwiZ2V0UGhvdG9EZXNjcmlwdGlvbiIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsInVwZGF0ZUlzRmF2b3VyaXRlIiwibm93IiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIm1vbnRoIiwiZGF5IiwieWVhciIsImlzRmF2b3VyaXRlIiwicmVzdGF1cmFudF9pZCIsInBhcnNlSW50IiwiY3JlYXRlZEF0Iiwic2VuZERhdGEiLCJ0aGVuIiwiYSIsInNhdmVMb2NhbGx5IiwiZGF0YSIsIl91cGRhdGVEQiIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWFkeSIsInJlZyIsInN5bmMiLCJyZWdpc3RlciIsImNhdGNoIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsInRpbWUiLCJjb250YWluZXIiLCJ1bCIsImZpbGxTdWJtaXRSZXZpZXdGb3JtSFRNTCIsImxlbmd0aCIsIm5vUmV2aWV3cyIsImZvckVhY2giLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwibGkiLCJkYXRlIiwicmF0aW5nIiwiY29tbWVudHMiLCJmb3JtIiwibWV0aG9kIiwicmVzdGF1cmFudElEIiwibmFtZVNoZWxsIiwibmFtZUxibCIsImZvciIsIm5hbWVJbnB1dCIsInBsYWNlaG9sZGVyIiwicmF0aW5nU2hlbGwiLCJyYXRpbmdMYmwiLCJyYXRpbmdPcHRpb25zIiwiaSIsIm9wdGlvbiIsImNvbW1lbnRzU2hlbGwiLCJjb21tZW50c0xibCIsImNvbW1lbnRzVGV4dCIsInN1Ym1pdFNoZWxsIiwic3VibWl0QnRuIiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRSZXZpZXciLCJGRCIsIkZvcm1EYXRhIiwiYmFkRGF0YSIsInNhZmVTdHIiLCJlc2NhcGUiLCJwYXJlbnROb2RlIiwidW5lc2NhcGUiLCJyZXZpZXdOb2RlIiwiaW5zZXJ0QmVmb3JlIiwicmVtb3ZlQ2hpbGQiLCJicmVhZGNydW1iIiwicmVzZXRCcmVhZGNydW1iIiwiY2hpbGRyZW4iLCJpdGVtIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlc3VsdHMiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxXQUFZQyxRQUNoQixJQUFJQyxJQUtKQyxTQUFTQyxpQkFBaUIsbUJBQXFCQyxJQUM3Q0MsU0FBU0Msd0JBQ1RDLEtBQUtDLFdBQWFILFNBQVNJLGVBQzNCRixLQUFLRyxZQUFjLElBQUlDLE1BQ3ZCQywyQkFNRkMsaUJBQW1CLEVBQUNDLEVBQUtDLEVBQVVDLEtBQ2pDVCxLQUFLRyxZQUFZTyxPQUFPSCxFQUFLQyxFQUFVQyxLQU16Q0UsT0FBT0MsUUFBVSxNQUNYQyxLQUFLckIsYUFDUHFCLEtBQUtuQixJQUFNLElBQUlvQixPQUFPQyxLQUFLQyxJQUFJckIsU0FBU3NCLGVBQWUsT0FBUSxDQUM3REMsS0FBTSxHQUNOQyxPQUFRTixLQUFLckIsV0FBVzRCLE9BQ3hCQyxhQUFhLElBRWZ2QixTQUFTd0IsdUJBQXVCVCxLQUFLckIsV0FBWXFCLEtBQUtuQixRQU8xRFcsdUJBQXlCLE1BQ3ZCLEdBQUlRLEtBQUtyQixXQUVQLE9BRUYsTUFBTStCLEVBQUtDLG1CQUFtQixNQUN6QkQsR0FLSHpCLFNBQVMyQixjQUFjLGNBQWVGLEVBQUl2QixLQUFLQyxXQUFZLENBQUN5QixFQUFPbkIsRUFBS2YsS0FDdEVxQixLQUFLckIsV0FBYUEsRUFDZGtDLEVBQ0ZwQixpQkFBaUJvQixJQUVUbkIsR0FDUkQsaUJBQWlCQyxHQUduQm9CLHFCQUNBQyxPQUFPQyxjQUdUL0IsU0FBU2dDLDJCQUEyQlAsRUFBSXZCLEtBQUtDLFdBQVksQ0FBQ3lCLEVBQU9uQixFQUFLZCxLQUNoRWlDLEdBQ0ZwQixpQkFBaUJvQixHQUNqQkssbUJBQ1F4QixHQUNSRCxpQkFBaUJDLEdBR25CeUIsYUFBYXZDLEdBRWJzQyxxQkExQkZ6QixpQkFBaUIsNkJBa0NyQjBCLGFBQWUsQ0FBQ3ZD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Q2xDLE1BQU1nSixFQUFhN0ksU0FBU3NCLGVBQWUsY0FDM0N3SCxnQkFBZ0JELEdBQ2hCLE1BQU1sQyxFQUFLM0csU0FBUzJDLGNBQWMsTUFDbENnRSxFQUFHL0QsYUFBYSxlQUFnQixRQUNoQytELEVBQUdyRSxVQUFZekMsRUFBV2dELEtBQzFCZ0csRUFBV3ZGLFlBQVlxRCxLQU16Qm1DLGdCQUFrQixDQUFDRCxJQUNqQixNQUFNdkMsRUFBU3VDLEVBQVdFLFNBQVN6QyxPQUNuQyxJQUFLLElBQUlvQixFQUFJLEVBQUdBLEVBQUlwQixFQUFRb0IsSUFDMUJtQixFQUFXRCxZQUFZQyxFQUFXRSxTQUFTQyxLQUFLdEIsTUFPcEQ3RixtQkFBcUIsRUFBQ2dCLEVBQU1vRyxLQUNyQkEsSUFDSEEsRUFBTWpJLE9BQU9rSSxTQUFTQyxNQUN4QnRHLEVBQU9BLEVBQUt1RyxRQUFRLFVBQVcsUUFDL0IsTUFDRUMsRUFEWSxJQUFJQyxjQUFjekcsc0JBQ2QwRyxLQUFLTixHQUN2QixPQUFLSSxFQUVBQSxFQUFRLEdBRU5HLG1CQUFtQkgsRUFBUSxHQUFHRCxRQUFRLE1BQU8sTUFEM0MsR0FGQSIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudCwgcmV2aWV3cztcbnZhciBtYXA7XG5cbi8qKlxuICogRmV0Y2ggZGF0YSBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBEQkhlbHBlci5yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcbiAgdGhpcy5fZGJQcm9taXNlID0gREJIZWxwZXIub3BlbkRhdGFiYXNlKCk7XG4gIHRoaXMuX3RvYXN0c1ZpZXcgPSBuZXcgVG9hc3QoKTtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpO1xufSk7XG5cbi8qKlxuICogRGlzcGxheSBub3RpZmljYXRpb25zLlxuICovXG5zaG93Tm90aWZpY2F0aW9uID0gKG1zZywgZHVyYXRpb24sIG9wdGlvbnMpID0+IHtcbiAgdGhpcy5fdG9hc3RzVmlldy5jcmVhdGUobXNnLCBkdXJhdGlvbiwgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkge1xuICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgIHpvb206IDE2LFxuICAgICAgY2VudGVyOiBzZWxmLnJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgfSk7XG4gICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9ICgpID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICAvL2NhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHtcbiAgICAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBzaG93Tm90aWZpY2F0aW9uKCdObyByZXN0YXVyYW50IGlkIGluIFVSTCcpO1xuICAgIHJldHVybjtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaERhdGFCeUlkKCdyZXN0YXVyYW50cycsIGlkLCB0aGlzLl9kYlByb21pc2UsIChlcnJvciwgbXNnLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHNob3dOb3RpZmljYXRpb24oZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYobXNnKSB7XG4gICAgICAgIHNob3dOb3RpZmljYXRpb24obXNnKTtcbiAgICAgIH1cblxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBIZWxwZXIubGF6eUxvYWQoKTtcbiAgICB9KTtcblxuICAgIERCSGVscGVyLmZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkKGlkLCB0aGlzLl9kYlByb21pc2UsIChlcnJvciwgbXNnLCByZXZpZXdzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgc2hvd05vdGlmaWNhdGlvbihlcnJvcik7XG4gICAgICAgIGZpbGxSZXZpZXdzSFRNTCgpO1xuICAgICAgfSBlbHNlIGlmKG1zZykge1xuICAgICAgICBzaG93Tm90aWZpY2F0aW9uKG1zZyk7XG4gICAgICB9XG5cbiAgICAgIHJlc2V0UmV2aWV3cyhyZXZpZXdzKTtcbiAgICAgIC8vIGZpbGwgcmV2aWV3c1xuICAgICAgZmlsbFJldmlld3NIVE1MKCk7XG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJldmlld3MgYW5kIHRoZWlyIEhUTUwuXG4gKi9cbnJlc2V0UmV2aWV3cyA9IChyZXZpZXdzKSA9PiB7XG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcbiAgc2VsZi5yZXZpZXdzID0gW107XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcbiAgc2VsZi5yZXZpZXdzID0gcmV2aWV3cztcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgZmlsbEJyZWFkY3J1bWIoKTtcblxuICBjb25zdCBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJyk7XG4gIGRlc2NyaXB0aW9uLnNldEF0dHJpYnV0ZSgnbmFtZScsICdkZXNjcmlwdGlvbicpO1xuICBkZXNjcmlwdGlvbi5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnLCBgRGV0YWlsZWQgaW5mb3JtYXRpb24gYWJvdXQgJHtyZXN0YXVyYW50Lm5hbWV9YCk7XG4gIGhlYWQuYXBwZW5kKGRlc2NyaXB0aW9uKTtcblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbmFtZS50aXRsZSA9ICdyZXN0YXVyYW50IG5hbWUnO1xuICBjb25zdCBmYXZvdXJpdGVUb2dnbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBmYXZvdXJpdGVUb2dnbGUudHlwZSA9ICdjaGVja2JveCc7XG4gIGZhdm91cml0ZVRvZ2dsZS5uYW1lID0gJ2Zhdm91cml0ZSc7XG4gIGZhdm91cml0ZVRvZ2dsZS52YWx1ZSA9ICdmYXZvdXJpdGUnO1xuICBmYXZvdXJpdGVUb2dnbGUuaWQgPSAnZmF2b3VyaXRlJztcbiAgZmF2b3VyaXRlVG9nZ2xlLmNoZWNrZWQgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlO1xuICBmYXZvdXJpdGVUb2dnbGUuc2V0QXR0cmlidXRlKCdvbmNoYW5nZScsICd1cGRhdGVJc0Zhdm91cml0ZSgpJyk7XG4gIGNvbnN0IHRvZ2dsZUxibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHRvZ2dsZUxibC5zZXRBdHRyaWJ1dGUoJ2ZvcicsICdmYXZvdXJpdGUnKTtcbiAgbmFtZS5hcHBlbmRDaGlsZChmYXZvdXJpdGVUb2dnbGUpO1xuICBuYW1lLmFwcGVuZENoaWxkKHRvZ2dsZUxibCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGFkZHJlc3MudGl0bGUgPSAncmVzdGF1cmFudCBhZGRyZXNzJztcblxuICBjb25zdCBpbWdTcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgdHJ1ZSk7XG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLmNsYXNzTGlzdC5hZGQoJ2xhenknKTtcbiAgaW1hZ2Uuc3JjID0gaW1nU3JjO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpKTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsIERCSGVscGVyLmltYWdlU1JDU2V0VXJsc0ZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgWycxeCcsICcyeCddKSk7XG4gIGltYWdlLmFsdCA9IChyZXN0YXVyYW50LnBob3RvZ3JhcGgpID8gREJIZWxwZXIuZ2V0UGhvdG9EZXNjcmlwdGlvbihyZXN0YXVyYW50KSA6XG4gICdubyBwaWN0dXJlIGZvdW5kJztcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuICBjdWlzaW5lLnRpdGxlID0gJ3Jlc3RhdXJhbnQgY3Vpc2luZSB0eXBlJztcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG59XG5cbi8qKlxuICogSGFkbGUgZmF2b3VyaXRlIHRvZ2dsZVxuICovXG4gdXBkYXRlSXNGYXZvdXJpdGUgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICAgY29uc3QgaXNfZmF2b3JpdGUgPSAocmVzdGF1cmFudC5pc19mYXZvcml0ZSkgPyAwIDogMTtcblxuICAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICAgY29uc3QgaXNGYXZvdXJpdGUgPSB7XG4gICAgIFwicmVzdGF1cmFudF9pZFwiOiByZXN0YXVyYW50LmlkLFxuICAgICBcImlzX2Zhdm9yaXRlXCI6IHBhcnNlSW50KGlzX2Zhdm9yaXRlKSxcbiAgICAgXCJjcmVhdGVkQXRcIjogbm93XG4gICB9XG5cbiAgIHNlbmREYXRhKGlzRmF2b3VyaXRlKS50aGVuKChhKSA9PiB7XG4gICAgIHNhdmVMb2NhbGx5KClcbiAgIH0pO1xuIH1cblxuLyoqXG4gKiBTZW5kIGRhdGFcbiAqL1xuIHNlbmREYXRhID0gKGRhdGEpID0+IHtcbiAgcmV0dXJuIERCSGVscGVyLl91cGRhdGVEQignbmV3SXNGYXZvdXJpdGUnLCBkYXRhKS50aGVuKCgpID0+IHtcbiAgICAvLyBXYWl0IGZvciB0aGUgc2NvcGVkIHNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbiB0byBnZXQgYVxuICAgIC8vIHNlcnZpY2Ugd29ya2VyIHdpdGggYW4gYWN0aXZlIHN0YXRlXG4gICAgcmV0dXJuIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5O1xuICB9KS50aGVuKHJlZyA9PiB7XG4gICAgcmV0dXJuIHJlZy5zeW5jLnJlZ2lzdGVyKCdzZW5kLWlzRmF2b3VyaXRlJyk7XG4gIH0pLnRoZW4oKCkgPT4ge1xuICAgIHNob3dOb3RpZmljYXRpb24oYFJlc3RhdXJhbnQgaXMgJHsoZGF0YS5pc19mYXZvcml0ZSkgPyAnZmF2b3VyaXRlIG5vdyA6KScgOiAnbm90IGZhdm91cml0ZSBhbnltb3JlIDooJ31gLCAxLjUpO1xuICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignT29wcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuJywgMyk7XG4gIH0pO1xufVxuXG5zYXZlTG9jYWxseSA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSAhcmVzdGF1cmFudC5pc19mYXZvcml0ZTtcbiAgcmV0dXJuIERCSGVscGVyLl91cGRhdGVEQigncmVzdGF1cmFudHMnLCByZXN0YXVyYW50KS50aGVuKCgpID0+IHtcbiAgICAvL2NvbnNvbGUubG9nKCd1cGRhdGVkIGxvY2FsIGNvcHknKTtcbiAgfSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgaG91cnMuaW5uZXJIVE1MID0gJyc7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgZGF5LmNsYXNzTmFtZSA9ICdvcGVuaG91cnMtZGF5JztcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICB0aW1lLmNsYXNzTmFtZSA9ICdvcGVuaG91cnMtdGltZSc7XG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJldmlld3MpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICBmaWxsU3VibWl0UmV2aWV3Rm9ybUhUTUwodWwpO1xuXG4gIGlmIChyZXZpZXdzLmxlbmd0aCA9PT0gMCkge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcbiAgfSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbmFtZS5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBuYW1lLnRpdGxlID0gXCJyZXZpZXdlcidzIG5hbWVcIjtcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICBkYXRlLmlubmVySFRNTCA9IGNyZWF0ZWRBdDtcbiAgZGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3LWRhdGUnO1xuICBkYXRlLnRpdGxlID0gJ2RhdGUgd2hlbiByZXZpZXcgd2FzIHBvc3RlZCc7XG4gIGxpLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xuICByYXRpbmcuY2xhc3NOYW1lID0gJ3Jldmlldy1yYXRpbmcnO1xuICByYXRpbmcudGl0bGUgPSAnZ2l2ZW4gcmF0aW5nJztcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb21tZW50cy5jbGFzc05hbWUgPSAncmV2aWV3LWNvbW1lbnRzJztcbiAgY29tbWVudHMudGl0bGUgPSAnY29tbWVudHMgZnJvbSB0aGUgcmV2aWV3ZXInO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqICBDcmVhdGUgYSBIVE1MIHN1Ym1pdCBmb3JtIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxTdWJtaXRSZXZpZXdGb3JtSFRNTCA9ICh1bCwgcmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gIGZvcm0uaWQgPSAnZm9ybS1yZXZpZXcnO1xuICBmb3JtLm1ldGhvZCA9ICdQT1NUJztcbiAgZm9ybS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQWRkIHJldmlldyBmb3IgcmVzdGF1cmFudCcpO1xuXG4gIGNvbnN0IHJlc3RhdXJhbnRJRCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIHJlc3RhdXJhbnRJRC5pZCA9ICdyZXN0YXVyYW50X2lkJztcbiAgcmVzdGF1cmFudElELm5hbWUgPSAncmVzdGF1cmFudF9pZCc7XG4gIHJlc3RhdXJhbnRJRC50eXBlID0gJ2hpZGRlbic7XG4gIHJlc3RhdXJhbnRJRC52YWx1ZSA9IHJlc3RhdXJhbnQuaWQ7XG4gIGZvcm0uYXBwZW5kQ2hpbGQocmVzdGF1cmFudElEKTtcblxuICBjb25zdCBuYW1lU2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWVTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBjb25zdCBuYW1lTGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgbmFtZUxibC5pbm5lckhUTUwgPSAnKk5hbWU6JztcbiAgbmFtZUxibC5mb3IgPSAndU5hbWUnO1xuICBuYW1lTGJsLnRpdGxlID0gXCJyZXZpZXdlcidzIG5hbWVcIjtcbiAgbmFtZVNoZWxsLmFwcGVuZENoaWxkKG5hbWVMYmwpO1xuXG4gIGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIG5hbWVJbnB1dC5pZCA9ICd1TmFtZSc7XG4gIG5hbWVJbnB1dC5uYW1lID0gJ25hbWUnXG4gIG5hbWVJbnB1dC5wbGFjZWhvbGRlciA9ICdZb3VyIE5hbWUnO1xuICBuYW1lSW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLXJlcXVpcmVkJywgJ3RydWUnKVxuICBuYW1lSW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1lvdXIgbmFtZScpO1xuICBuYW1lTGJsLmFwcGVuZENoaWxkKG5hbWVJbnB1dCk7XG4gIGZvcm0uYXBwZW5kQ2hpbGQobmFtZVNoZWxsKTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb25zdCBvcHRpb25zID0ge21vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnLCB5ZWFyOiAnbnVtZXJpYyd9O1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tdXMnLCBvcHRpb25zKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBub3c7XG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlldy1kYXRlJztcbiAgZGF0ZS50aXRsZSA9ICdkYXRlIHdoZW4gcmV2aWV3IGlzIHBvc3RlZCc7XG4gIGZvcm0uYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nU2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZ1NoZWxsLmNsYXNzTmFtZSA9ICdyZXZpZXctcmF0aW5nJztcbiAgY29uc3QgcmF0aW5nTGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgcmF0aW5nTGJsLmlubmVySFRNTCA9ICdSYXRpbmc6JztcbiAgY29uc3QgcmF0aW5nT3B0aW9ucyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpO1xuICByYXRpbmdPcHRpb25zLm5hbWUgPSAncmF0aW5nJztcbiAgZm9yICh2YXIgaSA9IDE7IGkgPD0gNTsgaSsrKSB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLnZhbHVlID0gaTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gaTtcbiAgICByYXRpbmdPcHRpb25zLmFwcGVuZENoaWxkKG9wdGlvbik7XG4gIH1cbiAgcmF0aW5nTGJsLmFwcGVuZENoaWxkKHJhdGluZ09wdGlvbnMpO1xuICByYXRpbmdTaGVsbC5hcHBlbmRDaGlsZChyYXRpbmdMYmwpO1xuICBmb3JtLmFwcGVuZENoaWxkKHJhdGluZ1NoZWxsKTtcblxuICBjb25zdCBjb21tZW50c1NoZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb21tZW50c1NoZWxsLmNsYXNzTmFtZSA9ICdyZXZpZXctY29tbWVudHMnO1xuICBjb25zdCBjb21tZW50c0xibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIGNvbW1lbnRzTGJsLmlubmVySFRNTCA9ICcqQ29tbWVudHM6JztcbiAgY29uc3QgY29tbWVudHNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgY29tbWVudHNUZXh0Lm5hbWUgPSAnY29tbWVudHMnO1xuICBjb21tZW50c1RleHQuaWQgPSAnY29tbWVudHNUZXh0JztcbiAgY29tbWVudHNUZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1yZXF1aXJlZCcsICd0cnVlJylcbiAgY29tbWVudHNUZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdBZGRpdGlvbmFsIGNvbW1lbnRzIGZvciB0aGUgcmV2aWV3Jyk7XG4gIGNvbW1lbnRzU2hlbGwuYXBwZW5kQ2hpbGQoY29tbWVudHNMYmwpO1xuICBjb21tZW50c1NoZWxsLmFwcGVuZENoaWxkKGNvbW1lbnRzVGV4dCk7XG4gIGZvcm0uYXBwZW5kQ2hpbGQoY29tbWVudHNTaGVsbCk7XG5cbiAgY29uc3Qgc3VibWl0U2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBzdWJtaXRCdG4uaWQgPSAnc3VibWl0QnRuJztcbiAgc3VibWl0QnRuLnR5cGUgPSAnc3VibWl0JztcbiAgc3VibWl0QnRuLmlubmVySFRNTCA9ICdTdWJtaXQgUmV2aWV3ISc7XG4gIHN1Ym1pdEJ0bi52YWx1ZSA9ICdTdWJtaXQnO1xuICBzdWJtaXRCdG4uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1N1Ym1pdCByZXZpZXcnKTtcbiAgc3VibWl0U2hlbGwuYXBwZW5kQ2hpbGQoc3VibWl0QnRuKTtcbiAgZm9ybS5hcHBlbmRDaGlsZChzdWJtaXRTaGVsbCk7XG5cbiAgbGkuYXBwZW5kQ2hpbGQoZm9ybSk7XG4gIHVsLmFwcGVuZENoaWxkKGxpKTtcblxuICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIHN1Ym1pdFJldmlldyhmb3JtKTtcbiAgfSk7XG59XG5cbi8qKlxuKiBTdWJtaXQgcmV2aWV3cyB0aG91Z2ggamF2YXNjcmlwdC5cbiovXG5zdWJtaXRSZXZpZXcgPSAoZm9ybSkgPT4ge1xuICAvLyBCaW5kIHRoZSBGb3JtRGF0YSBvYmplY3QgYW5kIHRoZSBmb3JtIGVsZW1lbnRcbiAgY29uc3QgRkQgPSBuZXcgRm9ybURhdGEoZm9ybSk7XG5cbiAgY29uc3QgcmV2aWV3ID0ge307XG4gIGxldCBiYWREYXRhID0gZmFsc2U7XG4gIEZELmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgIGNvbnN0IHNhZmVTdHIgPSBlc2NhcGUodmFsdWUpO1xuICAgIGlmIChzYWZlU3RyID09PSAnJykge1xuICAgICAgc2hvd05vdGlmaWNhdGlvbihgT2ggbm8hIFNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgY2hlY2sgJHtrZXl9IGZpZWxkYCk7XG4gICAgICBiYWREYXRhID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV2aWV3W2tleV0gPSBzYWZlU3RyO1xuICB9KTtcblxuICByZXZpZXcucmF0aW5nID0gcGFyc2VJbnQocmV2aWV3LnJhdGluZyk7XG5cbiAgLy8gZG9uJ3QgcG9zdCBiYWRseSBmb3JtZWQgcmV2aWV3c1xuICBpZiAoYmFkRGF0YSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCB1bCA9IGZvcm0ucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICByZXZpZXdbJ2NyZWF0ZWRBdCddID0gbm93O1xuICBEQkhlbHBlci5fdXBkYXRlREIoJ25ld1InLCByZXZpZXcpO1xuICBEQkhlbHBlci5fdXBkYXRlREIoJ3Jldmlld3MnLCByZXZpZXcpO1xuXG4gIHJldmlldy5uYW1lID0gdW5lc2NhcGUocmV2aWV3Lm5hbWUpO1xuICByZXZpZXcuY29tbWVudHMgPSB1bmVzY2FwZShyZXZpZXcuY29tbWVudHMpO1xuICBsZXQgcmV2aWV3Tm9kZSA9IGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KTtcblxuICByZXR1cm4gbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkudGhlbihyZWcgPT4ge1xuICAgIHJldHVybiByZWcuc3luYy5yZWdpc3Rlcignc2VuZC1yZXZpZXdzJylcbiAgfSkudGhlbigoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignWW91ciByZXZpZXcgd2lsbCBiZSBwb3N0ZWQgYXMgc29vbiBhcyBwb3NzaWJsZS4nKTtcbiAgICB1bC5pbnNlcnRCZWZvcmUocmV2aWV3Tm9kZSwgZm9ybS5wYXJlbnROb2RlKTtcbiAgICB1bC5yZW1vdmVDaGlsZChmb3JtLnBhcmVudE5vZGUpO1xuICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignRXJyb3InKTtcbiAgfSk7XG59XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgcmVzZXRCcmVhZGNydW1iKGJyZWFkY3J1bWIpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50JywgJ3BhZ2UnKVxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xufVxuXG4vKipcbiAqIENsZWFyIGJyZWFkY3J1bWIsIHJlbW92ZXMgYWxsIGVudGl0aWVzIGV4Y2VwdCBmaXJzdCwgSG9tZS5cbiAqL1xucmVzZXRCcmVhZGNydW1iID0gKGJyZWFkY3J1bWIpID0+IHtcbiAgY29uc3QgbGVuZ3RoID0gYnJlYWRjcnVtYi5jaGlsZHJlbi5sZW5ndGg7XG4gIGZvciAobGV0IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICBicmVhZGNydW1iLnJlbW92ZUNoaWxkKGJyZWFkY3J1bWIuY2hpbGRyZW4uaXRlbShpKSk7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5nZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cylcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKVxuICAgIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cbiJdfQ==
