let restaurant,reviews;var map;document.addEventListener("DOMContentLoaded",e=>{DBHelper.registerServiceWorker(),this._toastsView=new Toast,fetchRestaurantFromURL()}),window.initMap=(()=>{self.restaurant&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))}),fetchRestaurantFromURL=(()=>{if(self.restaurant)return;const e=getParameterByName("id");e?DBHelper.fetchDataById("restaurants",e,(t,n)=>{self.restaurant=n,!t||n?DBHelper.fetchReviewsByRestaurantId(e,(e,t)=>{self.reviews=t.reverse(),e&&showNotification(e),fillRestaurantHTML(),Helper.lazyLoad()}):showNotification(t)}):showNotification("No restaurant id in URL")}),fillRestaurantHTML=((e=self.restaurant)=>{fillBreadcrumb();const t=document.getElementsByTagName("head")[0],n=document.createElement("meta");n.setAttribute("name","description"),n.setAttribute("content",`Detailed information about ${e.name}`),t.append(n);const a=document.getElementById("restaurant-name");a.innerHTML=e.name,a.title="restaurant name";const r=document.createElement("input");r.type="checkbox",r.name="favourite",r.value="favourite",r.id="favourite",r.checked=e.is_favorite,r.setAttribute("onchange","updateIsFavourite()");const i=document.createElement("label");i.setAttribute("for","favourite"),a.appendChild(r),a.appendChild(i);const s=document.getElementById("restaurant-address");s.innerHTML=e.address,s.title="restaurant address";const o=DBHelper.imageUrlForRestaurant(e,!0),l=document.getElementById("restaurant-img");l.className="restaurant-img",l.classList.add("lazy"),l.src=o,l.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),l.setAttribute("data-srcset",DBHelper.imageSRCSetUrlsForRestaurant(e,["1x","2x"])),l.alt=e.photograph?DBHelper.getPhotoDescription(e):"no picture found";const c=document.getElementById("restaurant-cuisine");c.innerHTML=e.cuisine_type,c.title="restaurant cuisine type",e.operating_hours&&fillRestaurantHoursHTML(),fillSubmitReviewFormHTML(),fillReviewsHTML()}),updateIsFavourite=((e=self.restaurant)=>{const t=e.is_favorite?0:1,n=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"}),a={restaurant_id:parseInt(e.id),is_favorite:parseInt(t),createdAt:n};sendData(a).then(e=>{saveLocally()})}),sendData=(e=>DBHelper._updateDB("newIsFavourite",e).then(()=>navigator.serviceWorker.ready).then(e=>e.sync.register("send-isFavourite")).then(()=>{showNotification(`Restaurant is ${e.is_favorite?"favourite now :)":"not favourite anymore :("}`)}).catch(()=>{showNotification("Oops! Something went wrong. :(")})),saveLocally=((e=self.restaurant)=>(e.is_favorite=!e.is_favorite,DBHelper._updateDB("restaurants",e).then(()=>{console.log("updated local copy")}))),showNotification=((e,t={buttons:["dismiss"]})=>{this._toastsView.create(e,t)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.className="openhours-day",a.appendChild(r);const i=document.createElement("td");i.innerHTML=e[n],i.className="openhours-time",a.appendChild(i),t.appendChild(a)}}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),0===e.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const a=document.getElementById("reviews-list");e.forEach(e=>{a.appendChild(createReviewHTML(e))}),t.appendChild(a)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,n.className="review-name",n.title="reviewer's name",t.appendChild(n);const a=document.createElement("p"),r=new Date(e.createdAt).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});a.innerHTML=r,a.className="review-date",a.title="date when review was posted",t.appendChild(a);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,i.className="review-rating",i.title="given rating",t.appendChild(i);const s=document.createElement("p");return s.innerHTML=e.comments,s.className="review-comments",s.title="comments from the reviewer",t.appendChild(s),t}),fillSubmitReviewFormHTML=((e=self.restaurant)=>{const t=document.getElementById("reviews-list"),n=document.createElement("li"),a=document.createElement("form");a.id="form-review",a.method="POST",a.setAttribute("aria-label","Add review for restaurant");const r=document.createElement("input");r.id="restaurant_id",r.name="restaurant_id",r.type="hidden",r.value=e.id,a.appendChild(r);const i=document.createElement("p");i.className="review-name";const s=document.createElement("label");s.innerHTML="* Name:",s.for="uName",s.title="reviewer's name",i.appendChild(s);const o=document.createElement("input");o.id="uName",o.name="name",o.placeholder="Your Name",o.setAttribute("aria-required","true"),o.setAttribute("aria-label","Your name"),s.appendChild(o),a.appendChild(i);const l=document.createElement("p"),c=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});l.innerHTML=c,l.className="review-date",l.title="date when review is posted",a.appendChild(l);const d=document.createElement("p");d.className="review-rating";const m=document.createElement("label");m.innerHTML="Rating:";const u=document.createElement("select");u.name="rating";for(var p=1;p<=5;p++){const e=document.createElement("option");e.value=p,e.innerHTML=p,u.appendChild(e)}m.appendChild(u),d.appendChild(m),a.appendChild(d);const h=document.createElement("p");h.className="review-comments";const v=document.createElement("label");v.innerHTML="* Comments:";const w=document.createElement("textarea");w.name="comments",w.id="commentsText",w.setAttribute("aria-required","true"),w.setAttribute("aria-label","Additional comments for the review"),h.appendChild(v),h.appendChild(w),a.appendChild(h);const f=document.createElement("p"),g=document.createElement("button");g.id="submitBtn",g.type="submit",g.innerHTML="Submit Review!",g.value="Submit",g.setAttribute("aria-label","Submit review"),f.appendChild(g),a.appendChild(f),n.appendChild(a),t.appendChild(n),a.addEventListener("submit",function(e){e.preventDefault(),submitReview(a)})}),submitReview=(e=>{const t=new FormData(e),n={};let a=!1;if(t.forEach(function(e,t){const r=escape(e);""===r&&(showNotification(`Oh no! Something went wrong, please check ${t} field`),a=!0),n[t]=r}),n.restaurant_id=parseInt(n.restaurant_id),n.rating=parseInt(n.rating),a)return;let r=e.parentNode.parentNode;const i=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});n.createdAt=i,DBHelper._updateDB("newR",n),DBHelper._updateDB("reviews",n),n.name=unescape(n.name),n.comments=unescape(n.comments);let s=createReviewHTML(n);return navigator.serviceWorker.ready.then(e=>e.sync.register("send-reviews")).then(()=>{showNotification("Your review will be posted as soon as possible."),r.insertBefore(s,e.parentNode),r.removeChild(e.parentNode)}).catch(()=>{showNotification("Error")})}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.setAttribute("aria-current","page"),n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm1hcCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiREJIZWxwZXIiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJ0aGlzIiwiX3RvYXN0c1ZpZXciLCJUb2FzdCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJ3aW5kb3ciLCJpbml0TWFwIiwic2VsZiIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJnZXRFbGVtZW50QnlJZCIsInpvb20iLCJjZW50ZXIiLCJsYXRsbmciLCJzY3JvbGx3aGVlbCIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJpZCIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoRGF0YUJ5SWQiLCJlcnJvciIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkIiwicmV2ZXJzZSIsInNob3dOb3RpZmljYXRpb24iLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJIZWxwZXIiLCJsYXp5TG9hZCIsImZpbGxCcmVhZGNydW1iIiwiaGVhZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZGVzY3JpcHRpb24iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwibmFtZSIsImFwcGVuZCIsImlubmVySFRNTCIsInRpdGxlIiwiZmF2b3VyaXRlVG9nZ2xlIiwidHlwZSIsInZhbHVlIiwiY2hlY2tlZCIsImlzX2Zhdm9yaXRlIiwidG9nZ2xlTGJsIiwiYXBwZW5kQ2hpbGQiLCJhZGRyZXNzIiwiaW1nU3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJhZGQiLCJzcmMiLCJpbWFnZVNSQ1NldFVybHNGb3JSZXN0YXVyYW50IiwiYWx0IiwiZ2V0UGhvdG9EZXNjcmlwdGlvbiIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxTdWJtaXRSZXZpZXdGb3JtSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsInVwZGF0ZUlzRmF2b3VyaXRlIiwibm93IiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIm1vbnRoIiwiZGF5IiwieWVhciIsImlzRmF2b3VyaXRlIiwicmVzdGF1cmFudF9pZCIsInBhcnNlSW50IiwiY3JlYXRlZEF0Iiwic2VuZERhdGEiLCJ0aGVuIiwiYSIsInNhdmVMb2NhbGx5IiwiZGF0YSIsIl91cGRhdGVEQiIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWFkeSIsInJlZyIsInN5bmMiLCJyZWdpc3RlciIsImNhdGNoIiwiY29uc29sZSIsImxvZyIsIm1zZyIsIm9wdGlvbnMiLCJidXR0b25zIiwiY3JlYXRlIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsInRpbWUiLCJjb250YWluZXIiLCJsZW5ndGgiLCJub1Jldmlld3MiLCJ1bCIsImZvckVhY2giLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwibGkiLCJkYXRlIiwicmF0aW5nIiwiY29tbWVudHMiLCJmb3JtIiwibWV0aG9kIiwicmVzdGF1cmFudElEIiwibmFtZVNoZWxsIiwibmFtZUxibCIsImZvciIsIm5hbWVJbnB1dCIsInBsYWNlaG9sZGVyIiwicmF0aW5nU2hlbGwiLCJyYXRpbmdMYmwiLCJyYXRpbmdPcHRpb25zIiwiaSIsIm9wdGlvbiIsImNvbW1lbnRzU2hlbGwiLCJjb21tZW50c0xibCIsImNvbW1lbnRzVGV4dCIsInN1Ym1pdFNoZWxsIiwic3VibWl0QnRuIiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRSZXZpZXciLCJGRCIsIkZvcm1EYXRhIiwiYmFkRGF0YSIsInNhZmVTdHIiLCJlc2NhcGUiLCJwYXJlbnROb2RlIiwidW5lc2NhcGUiLCJyZXZpZXdOb2RlIiwiaW5zZXJ0QmVmb3JlIiwicmVtb3ZlQ2hpbGQiLCJicmVhZGNydW1iIiwidXJsIiwibG9jYXRpb24iLCJo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LG1CQUFxQixFQUFDZSxFQUFNeUcsS0FDckJBLElBQ0hBLEVBQU1ySSxPQUFPc0ksU0FBU0MsTUFDeEIzRyxFQUFPQSxFQUFLNEcsUUFBUSxVQUFXLFFBQy9CLE1BQ0VDLEVBRFksSUFBSUMsY0FBYzlHLHNCQUNkK0csS0FBS04sR0FDdkIsT0FBS0ksRUFFQUEsRUFBUSxHQUVORyxtQkFBbUJILEVBQVEsR0FBR0QsUUFBUSxNQUFPLE1BRDNDLEdBRkEiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnQsIHJldmlld3M7XG52YXIgbWFwO1xuXG4vKipcbiAqIEZldGNoIGRhdGEgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcbiAgREJIZWxwZXIucmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XG4gIHRoaXMuX3RvYXN0c1ZpZXcgPSBuZXcgVG9hc3QoKTtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpO1xufSk7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkge1xuICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgIHpvb206IDE2LFxuICAgICAgY2VudGVyOiBzZWxmLnJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgfSk7XG4gICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9ICgpID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICAvL2NhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHtcbiAgICAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBzaG93Tm90aWZpY2F0aW9uKCdObyByZXN0YXVyYW50IGlkIGluIFVSTCcpO1xuICAgIHJldHVybjtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaERhdGFCeUlkKCdyZXN0YXVyYW50cycsIGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XG4gICAgICBpZiAoZXJyb3IgJiYgIXJlc3RhdXJhbnQpIHtcbiAgICAgICAgc2hvd05vdGlmaWNhdGlvbihlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQoaWQsIChlcnJvciwgcmV2aWV3cykgPT4ge1xuICAgICAgICBzZWxmLnJldmlld3MgPSByZXZpZXdzLnJldmVyc2UoKTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgc2hvd05vdGlmaWNhdGlvbihlcnJvcik7XG4gICAgICAgIH1cblxuICAgICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgICAgSGVscGVyLmxhenlMb2FkKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGZpbGxCcmVhZGNydW1iKCk7XG5cbiAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gIGNvbnN0IGRlc2NyaXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbWV0YScpO1xuICBkZXNjcmlwdGlvbi5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZGVzY3JpcHRpb24nKTtcbiAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKCdjb250ZW50JywgYERldGFpbGVkIGluZm9ybWF0aW9uIGFib3V0ICR7cmVzdGF1cmFudC5uYW1lfWApO1xuICBoZWFkLmFwcGVuZChkZXNjcmlwdGlvbik7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIG5hbWUudGl0bGUgPSAncmVzdGF1cmFudCBuYW1lJztcbiAgY29uc3QgZmF2b3VyaXRlVG9nZ2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgZmF2b3VyaXRlVG9nZ2xlLnR5cGUgPSAnY2hlY2tib3gnO1xuICBmYXZvdXJpdGVUb2dnbGUubmFtZSA9ICdmYXZvdXJpdGUnO1xuICBmYXZvdXJpdGVUb2dnbGUudmFsdWUgPSAnZmF2b3VyaXRlJztcbiAgZmF2b3VyaXRlVG9nZ2xlLmlkID0gJ2Zhdm91cml0ZSc7XG4gIGZhdm91cml0ZVRvZ2dsZS5jaGVja2VkID0gcmVzdGF1cmFudC5pc19mYXZvcml0ZTtcbiAgZmF2b3VyaXRlVG9nZ2xlLnNldEF0dHJpYnV0ZSgnb25jaGFuZ2UnLCAndXBkYXRlSXNGYXZvdXJpdGUoKScpO1xuICBjb25zdCB0b2dnbGVMYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICB0b2dnbGVMYmwuc2V0QXR0cmlidXRlKCdmb3InLCAnZmF2b3VyaXRlJyk7XG4gIG5hbWUuYXBwZW5kQ2hpbGQoZmF2b3VyaXRlVG9nZ2xlKTtcbiAgbmFtZS5hcHBlbmRDaGlsZCh0b2dnbGVMYmwpO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuICBhZGRyZXNzLnRpdGxlID0gJ3Jlc3RhdXJhbnQgYWRkcmVzcyc7XG5cbiAgY29uc3QgaW1nU3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHRydWUpO1xuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5jbGFzc0xpc3QuYWRkKCdsYXp5Jyk7XG4gIGltYWdlLnNyYyA9IGltZ1NyYztcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSk7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmNzZXQnLCBEQkhlbHBlci5pbWFnZVNSQ1NldFVybHNGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIFsnMXgnLCAnMngnXSkpO1xuICBpbWFnZS5hbHQgPSAocmVzdGF1cmFudC5waG90b2dyYXBoKSA/IERCSGVscGVyLmdldFBob3RvRGVzY3JpcHRpb24ocmVzdGF1cmFudCkgOlxuICAnbm8gcGljdHVyZSBmb3VuZCc7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcbiAgY3Vpc2luZS50aXRsZSA9ICdyZXN0YXVyYW50IGN1aXNpbmUgdHlwZSc7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuICAvLyBmaWxsIHN1Ym1pdCByZXZpZXcgZm9ybVxuICBmaWxsU3VibWl0UmV2aWV3Rm9ybUhUTUwoKTtcbiAgLy8gZmlsbCByZXZpZXdzXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xufVxuXG4vKipcbiAqIEhhZGxlIGZhdm91cml0ZSB0b2dnbGVcbiAqL1xuIHVwZGF0ZUlzRmF2b3VyaXRlID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgIGNvbnN0IGlzX2Zhdm9yaXRlID0gKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpID8gMCA6IDE7XG5cbiAgIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tdXMnLCBvcHRpb25zKTtcbiAgIGNvbnN0IGlzRmF2b3VyaXRlID0ge1xuICAgICBcInJlc3RhdXJhbnRfaWRcIjogcGFyc2VJbnQocmVzdGF1cmFudC5pZCksXG4gICAgIFwiaXNfZmF2b3JpdGVcIjogcGFyc2VJbnQoaXNfZmF2b3JpdGUpLFxuICAgICBcImNyZWF0ZWRBdFwiOiBub3dcbiAgIH1cblxuICAgc2VuZERhdGEoaXNGYXZvdXJpdGUpLnRoZW4oKGEpID0+IHtcbiAgICAgc2F2ZUxvY2FsbHkoKVxuICAgfSk7XG4gfVxuXG4vKipcbiAqIFNlbmQgZGF0YVxuICovXG4gc2VuZERhdGEgPSAoZGF0YSkgPT4ge1xuICByZXR1cm4gREJIZWxwZXIuX3VwZGF0ZURCKCduZXdJc0Zhdm91cml0ZScsIGRhdGEpLnRoZW4oKCkgPT4ge1xuICAgIC8vIFdhaXQgZm9yIHRoZSBzY29wZWQgc2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uIHRvIGdldCBhXG4gICAgLy8gc2VydmljZSB3b3JrZXIgd2l0aCBhbiBhY3RpdmUgc3RhdGVcbiAgICByZXR1cm4gbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7XG4gIH0pLnRoZW4ocmVnID0+IHtcbiAgICByZXR1cm4gcmVnLnN5bmMucmVnaXN0ZXIoJ3NlbmQtaXNGYXZvdXJpdGUnKTtcbiAgfSkudGhlbigoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbihgUmVzdGF1cmFudCBpcyAkeyhkYXRhLmlzX2Zhdm9yaXRlKSA/ICdmYXZvdXJpdGUgbm93IDopJyA6ICdub3QgZmF2b3VyaXRlIGFueW1vcmUgOignfWApO1xuICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignT29wcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuIDooJyk7XG4gIH0pO1xufVxuXG5zYXZlTG9jYWxseSA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSAhcmVzdGF1cmFudC5pc19mYXZvcml0ZTtcbiAgcmV0dXJuIERCSGVscGVyLl91cGRhdGVEQigncmVzdGF1cmFudHMnLCByZXN0YXVyYW50KS50aGVuKCgpID0+IHtcbiAgICBjb25zb2xlLmxvZygndXBkYXRlZCBsb2NhbCBjb3B5Jyk7XG4gIH0pO1xufVxuXG4vKipcbiAqIERpc3BsYXkgbm90aWZpY2F0aW9ucy5cbiAqL1xuc2hvd05vdGlmaWNhdGlvbiA9IChtc2csIG9wdGlvbnMgPSB7YnV0dG9uczogWydkaXNtaXNzJ119KSA9PiB7XG4gIHRoaXMuX3RvYXN0c1ZpZXcuY3JlYXRlKG1zZywgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICBkYXkuY2xhc3NOYW1lID0gJ29wZW5ob3Vycy1kYXknO1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHRpbWUuY2xhc3NOYW1lID0gJ29wZW5ob3Vycy10aW1lJztcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmV2aWV3cykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgaWYgKHJldmlld3MubGVuZ3RoID09PSAwKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jldmlldy1uYW1lJztcbiAgbmFtZS50aXRsZSA9IFwicmV2aWV3ZXIncyBuYW1lXCI7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tdXMnLCBvcHRpb25zKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBjcmVhdGVkQXQ7XG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlldy1kYXRlJztcbiAgZGF0ZS50aXRsZSA9ICdkYXRlIHdoZW4gcmV2aWV3IHdhcyBwb3N0ZWQnO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICdyZXZpZXctcmF0aW5nJztcbiAgcmF0aW5nLnRpdGxlID0gJ2dpdmVuIHJhdGluZyc7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgY29tbWVudHMuY2xhc3NOYW1lID0gJ3Jldmlldy1jb21tZW50cyc7XG4gIGNvbW1lbnRzLnRpdGxlID0gJ2NvbW1lbnRzIGZyb20gdGhlIHJldmlld2VyJztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn1cblxuLyoqXG4gKiAgQ3JlYXRlIGEgSFRNTCBzdWJtaXQgZm9ybSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsU3VibWl0UmV2aWV3Rm9ybUhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcblxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gIGZvcm0uaWQgPSAnZm9ybS1yZXZpZXcnO1xuICBmb3JtLm1ldGhvZCA9ICdQT1NUJztcbiAgZm9ybS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQWRkIHJldmlldyBmb3IgcmVzdGF1cmFudCcpO1xuXG4gIGNvbnN0IHJlc3RhdXJhbnRJRCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIHJlc3RhdXJhbnRJRC5pZCA9ICdyZXN0YXVyYW50X2lkJztcbiAgcmVzdGF1cmFudElELm5hbWUgPSAncmVzdGF1cmFudF9pZCc7XG4gIHJlc3RhdXJhbnRJRC50eXBlID0gJ2hpZGRlbic7XG4gIHJlc3RhdXJhbnRJRC52YWx1ZSA9IHJlc3RhdXJhbnQuaWQ7XG4gIGZvcm0uYXBwZW5kQ2hpbGQocmVzdGF1cmFudElEKTtcblxuICBjb25zdCBuYW1lU2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWVTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBjb25zdCBuYW1lTGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgbmFtZUxibC5pbm5lckhUTUwgPSAnKiBOYW1lOic7XG4gIG5hbWVMYmwuZm9yID0gJ3VOYW1lJztcbiAgbmFtZUxibC50aXRsZSA9IFwicmV2aWV3ZXIncyBuYW1lXCI7XG4gIG5hbWVTaGVsbC5hcHBlbmRDaGlsZChuYW1lTGJsKTtcblxuICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBuYW1lSW5wdXQuaWQgPSAndU5hbWUnO1xuICBuYW1lSW5wdXQubmFtZSA9ICduYW1lJ1xuICBuYW1lSW5wdXQucGxhY2Vob2xkZXIgPSAnWW91ciBOYW1lJztcbiAgbmFtZUlucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1yZXF1aXJlZCcsICd0cnVlJylcbiAgbmFtZUlucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdZb3VyIG5hbWUnKTtcbiAgbmFtZUxibC5hcHBlbmRDaGlsZChuYW1lSW5wdXQpO1xuICBmb3JtLmFwcGVuZENoaWxkKG5hbWVTaGVsbCk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLXVzJywgb3B0aW9ucyk7XG4gIGRhdGUuaW5uZXJIVE1MID0gbm93O1xuICBkYXRlLmNsYXNzTmFtZSA9ICdyZXZpZXctZGF0ZSc7XG4gIGRhdGUudGl0bGUgPSAnZGF0ZSB3aGVuIHJldmlldyBpcyBwb3N0ZWQnO1xuICBmb3JtLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIGNvbnN0IHJhdGluZ1NoZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmdTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LXJhdGluZyc7XG4gIGNvbnN0IHJhdGluZ0xibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHJhdGluZ0xibC5pbm5lckhUTUwgPSAnUmF0aW5nOic7XG4gIGNvbnN0IHJhdGluZ09wdGlvbnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTtcbiAgcmF0aW5nT3B0aW9ucy5uYW1lID0gJ3JhdGluZyc7XG4gIGZvciAodmFyIGkgPSAxOyBpIDw9IDU7IGkrKykge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi52YWx1ZSA9IGk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGk7XG4gICAgcmF0aW5nT3B0aW9ucy5hcHBlbmRDaGlsZChvcHRpb24pO1xuICB9XG4gIHJhdGluZ0xibC5hcHBlbmRDaGlsZChyYXRpbmdPcHRpb25zKTtcbiAgcmF0aW5nU2hlbGwuYXBwZW5kQ2hpbGQocmF0aW5nTGJsKTtcbiAgZm9ybS5hcHBlbmRDaGlsZChyYXRpbmdTaGVsbCk7XG5cbiAgY29uc3QgY29tbWVudHNTaGVsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHNTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LWNvbW1lbnRzJztcbiAgY29uc3QgY29tbWVudHNMYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICBjb21tZW50c0xibC5pbm5lckhUTUwgPSAnKiBDb21tZW50czonO1xuICBjb25zdCBjb21tZW50c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICBjb21tZW50c1RleHQubmFtZSA9ICdjb21tZW50cyc7XG4gIGNvbW1lbnRzVGV4dC5pZCA9ICdjb21tZW50c1RleHQnO1xuICBjb21tZW50c1RleHQuc2V0QXR0cmlidXRlKCdhcmlhLXJlcXVpcmVkJywgJ3RydWUnKVxuICBjb21tZW50c1RleHQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0FkZGl0aW9uYWwgY29tbWVudHMgZm9yIHRoZSByZXZpZXcnKTtcbiAgY29tbWVudHNTaGVsbC5hcHBlbmRDaGlsZChjb21tZW50c0xibCk7XG4gIGNvbW1lbnRzU2hlbGwuYXBwZW5kQ2hpbGQoY29tbWVudHNUZXh0KTtcbiAgZm9ybS5hcHBlbmRDaGlsZChjb21tZW50c1NoZWxsKTtcblxuICBjb25zdCBzdWJtaXRTaGVsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgc3VibWl0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIHN1Ym1pdEJ0bi5pZCA9ICdzdWJtaXRCdG4nO1xuICBzdWJtaXRCdG4udHlwZSA9ICdzdWJtaXQnO1xuICBzdWJtaXRCdG4uaW5uZXJIVE1MID0gJ1N1Ym1pdCBSZXZpZXchJztcbiAgc3VibWl0QnRuLnZhbHVlID0gJ1N1Ym1pdCc7XG4gIHN1Ym1pdEJ0bi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnU3VibWl0IHJldmlldycpO1xuICBzdWJtaXRTaGVsbC5hcHBlbmRDaGlsZChzdWJtaXRCdG4pO1xuICBmb3JtLmFwcGVuZENoaWxkKHN1Ym1pdFNoZWxsKTtcblxuICBsaS5hcHBlbmRDaGlsZChmb3JtKTtcbiAgdWwuYXBwZW5kQ2hpbGQobGkpO1xuXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgc3VibWl0UmV2aWV3KGZvcm0pO1xuICB9KTtcbn1cblxuLyoqXG4qIFN1Ym1pdCByZXZpZXdzIHRob3VnaCBqYXZhc2NyaXB0LlxuKi9cbnN1Ym1pdFJldmlldyA9IChmb3JtKSA9PiB7XG4gIC8vIEJpbmQgdGhlIEZvcm1EYXRhIG9iamVjdCBhbmQgdGhlIGZvcm0gZWxlbWVudFxuICBjb25zdCBGRCA9IG5ldyBGb3JtRGF0YShmb3JtKTtcblxuICBjb25zdCByZXZpZXcgPSB7fTtcbiAgbGV0IGJhZERhdGEgPSBmYWxzZTtcbiAgRkQuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgY29uc3Qgc2FmZVN0ciA9IGVzY2FwZSh2YWx1ZSk7XG4gICAgaWYgKHNhZmVTdHIgPT09ICcnKSB7XG4gICAgICBzaG93Tm90aWZpY2F0aW9uKGBPaCBubyEgU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSBjaGVjayAke2tleX0gZmllbGRgKTtcbiAgICAgIGJhZERhdGEgPSB0cnVlO1xuICAgIH1cbiAgICByZXZpZXdba2V5XSA9IHNhZmVTdHI7XG4gIH0pO1xuXG4gIHJldmlldy5yZXN0YXVyYW50X2lkID0gcGFyc2VJbnQocmV2aWV3LnJlc3RhdXJhbnRfaWQpO1xuICByZXZpZXcucmF0aW5nID0gcGFyc2VJbnQocmV2aWV3LnJhdGluZyk7XG5cbiAgLy8gZG9uJ3QgcG9zdCBiYWRseSBmb3JtZWQgcmV2aWV3c1xuICBpZiAoYmFkRGF0YSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCB1bCA9IGZvcm0ucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSB7bW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIHllYXI6ICdudW1lcmljJ307XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICByZXZpZXdbJ2NyZWF0ZWRBdCddID0gbm93O1xuICBEQkhlbHBlci5fdXBkYXRlREIoJ25ld1InLCByZXZpZXcpO1xuICBEQkhlbHBlci5fdXBkYXRlREIoJ3Jldmlld3MnLCByZXZpZXcpO1xuXG4gIHJldmlldy5uYW1lID0gdW5lc2NhcGUocmV2aWV3Lm5hbWUpO1xuICByZXZpZXcuY29tbWVudHMgPSB1bmVzY2FwZShyZXZpZXcuY29tbWVudHMpO1xuICBsZXQgcmV2aWV3Tm9kZSA9IGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KTtcblxuICByZXR1cm4gbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkudGhlbihyZWcgPT4ge1xuICAgIHJldHVybiByZWcuc3luYy5yZWdpc3Rlcignc2VuZC1yZXZpZXdzJylcbiAgfSkudGhlbigoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignWW91ciByZXZpZXcgd2lsbCBiZSBwb3N0ZWQgYXMgc29vbiBhcyBwb3NzaWJsZS4nKTtcbiAgICB1bC5pbnNlcnRCZWZvcmUocmV2aWV3Tm9kZSwgZm9ybS5wYXJlbnROb2RlKTtcbiAgICB1bC5yZW1vdmVDaGlsZChmb3JtLnBhcmVudE5vZGUpO1xuICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignRXJyb3InKTtcbiAgfSk7XG59XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY3VycmVudCcsICdwYWdlJylcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5nZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cylcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKVxuICAgIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cbiJdfQ==
