let restaurant,reviews;var map;document.addEventListener("DOMContentLoaded",e=>{DBHelper.registerServiceWorker(),this._toastsView=new Toast,fetchRestaurantFromURL()}),window.initMap=(()=>{self.restaurant&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))}),fetchRestaurantFromURL=(()=>{if(self.restaurant)return;const e=getParameterByName("id");e?DBHelper.fetchDataById("restaurants",e,(t,n)=>{self.restaurant=n,!t||n?DBHelper.fetchReviewsByRestaurantId(e,(e,t)=>{self.reviews=t.reverse(),e&&showNotification(e),fillRestaurantHTML(),Helper.lazyLoad()}):showNotification(t)}):showNotification("No restaurant id in URL")}),fillRestaurantHTML=((e=self.restaurant)=>{fillBreadcrumb();const t=document.getElementsByTagName("head")[0],n=document.createElement("meta");n.setAttribute("name","description"),n.setAttribute("content",`Detailed information about ${e.name}`),t.append(n);const a=document.getElementById("restaurant-name");a.innerHTML=e.name,a.title="restaurant name";const r=document.createElement("input");r.type="checkbox",r.name="favourite",r.value="favourite",r.id="favourite",r.checked=e.is_favorite,r.setAttribute("onchange","updateIsFavourite()");const i=document.createElement("label");i.setAttribute("for","favourite"),a.appendChild(r),a.appendChild(i);const s=document.getElementById("restaurant-address");s.innerHTML=e.address,s.title="restaurant address";const o=DBHelper.imageUrlForRestaurant(e,!0),c=document.getElementById("restaurant-img");c.className="restaurant-img",c.classList.add("lazy"),c.src=o,c.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),c.setAttribute("data-srcset",DBHelper.imageSRCSetUrlsForRestaurant(e,["1x","2x"])),c.alt=e.photograph?DBHelper.getPhotoDescription(e):"no picture found";const l=document.getElementById("restaurant-cuisine");l.innerHTML=e.cuisine_type,l.title="restaurant cuisine type",e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),updateIsFavourite=((e=self.restaurant)=>{const t=e.is_favorite?0:1,n=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"}),a={restaurant_id:e.id,is_favorite:parseInt(t),createdAt:n};sendData(a).then(e=>{saveLocally()})}),sendData=(e=>DBHelper._updateDB("newIsFavourite",e).then(()=>navigator.serviceWorker.ready).then(e=>e.sync.register("send-isFavourite")).then(()=>{showNotification(`Restaurant is ${e.is_favorite?"favourite now :)":"not favourite anymore :("}`)}).catch(()=>{showNotification("Oops! Something went wrong. :(")})),saveLocally=((e=self.restaurant)=>(e.is_favorite=!e.is_favorite,DBHelper._updateDB("restaurants",e).then(()=>{}))),showNotification=((e,t={buttons:["dismiss"]})=>{this._toastsView.create(e,t)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.className="openhours-day",a.appendChild(r);const i=document.createElement("td");i.innerHTML=e[n],i.className="openhours-time",a.appendChild(i),t.appendChild(a)}}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list"),a=document.createElement("h3");if(a.innerHTML="Reviews",t.insertBefore(a,n),fillSubmitReviewFormHTML(n),0===e.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}e.forEach(e=>{n.appendChild(createReviewHTML(e))})}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,n.className="review-name",n.title="reviewer's name",t.appendChild(n);const a=document.createElement("p"),r=new Date(e.createdAt).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});a.innerHTML=r,a.className="review-date",a.title="date when review was posted",t.appendChild(a);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,i.className="review-rating",i.title="given rating",t.appendChild(i);const s=document.createElement("p");return s.innerHTML=e.comments,s.className="review-comments",s.title="comments from the reviewer",t.appendChild(s),t}),fillSubmitReviewFormHTML=((e,t=self.restaurant)=>{const n=document.createElement("li"),a=document.createElement("form");a.id="form-review",a.method="POST",a.setAttribute("aria-label","Add review for restaurant");const r=document.createElement("input");r.id="restaurant_id",r.name="restaurant_id",r.type="hidden",r.value=t.id,a.appendChild(r);const i=document.createElement("p");i.className="review-name";const s=document.createElement("label");s.innerHTML="* Name:",s.for="uName",s.title="reviewer's name",i.appendChild(s);const o=document.createElement("input");o.id="uName",o.name="name",o.placeholder="Your Name",o.setAttribute("aria-required","true"),o.setAttribute("aria-label","Your name"),s.appendChild(o),a.appendChild(i);const c=document.createElement("p"),l=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});c.innerHTML=l,c.className="review-date",c.title="date when review is posted",a.appendChild(c);const d=document.createElement("p");d.className="review-rating";const m=document.createElement("label");m.innerHTML="Rating:";const u=document.createElement("select");u.name="rating";for(var p=1;p<=5;p++){const e=document.createElement("option");e.value=p,e.innerHTML=p,u.appendChild(e)}m.appendChild(u),d.appendChild(m),a.appendChild(d);const h=document.createElement("p");h.className="review-comments";const v=document.createElement("label");v.innerHTML="* Comments:";const f=document.createElement("textarea");f.name="comments",f.id="commentsText",f.setAttribute("aria-required","true"),f.setAttribute("aria-label","Additional comments for the review"),h.appendChild(v),h.appendChild(f),a.appendChild(h);const w=document.createElement("p"),g=document.createElement("button");g.id="submitBtn",g.type="submit",g.innerHTML="Submit Review!",g.value="Submit",g.setAttribute("aria-label","Submit review"),w.appendChild(g),a.appendChild(w),n.appendChild(a),e.appendChild(n),a.addEventListener("submit",function(e){e.preventDefault(),submitReview(a)})}),submitReview=(e=>{const t=new FormData(e),n={};let a=!1;if(t.forEach(function(e,t){const r=escape(e);""===r&&(showNotification(`Oh no! Something went wrong, please check ${t} field`),a=!0),n[t]=r}),n.rating=parseInt(n.rating),a)return;let r=e.parentNode.parentNode;const i=(new Date).toLocaleDateString("en-us",{month:"long",day:"numeric",year:"numeric"});n.createdAt=i,DBHelper._updateDB("newR",n),DBHelper._updateDB("reviews",n),n.name=unescape(n.name),n.comments=unescape(n.comments);let s=createReviewHTML(n);return navigator.serviceWorker.ready.then(e=>e.sync.register("send-reviews")).then(()=>{showNotification("Your review will be posted as soon as possible."),r.insertBefore(s,e.parentNode),r.removeChild(e.parentNode)}).catch(()=>{showNotification("Error")})}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.setAttribute("aria-current","page"),n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm1hcCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiREJIZWxwZXIiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJ0aGlzIiwiX3RvYXN0c1ZpZXciLCJUb2FzdCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJ3aW5kb3ciLCJpbml0TWFwIiwic2VsZiIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJnZXRFbGVtZW50QnlJZCIsInpvb20iLCJjZW50ZXIiLCJsYXRsbmciLCJzY3JvbGx3aGVlbCIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJpZCIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoRGF0YUJ5SWQiLCJlcnJvciIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkIiwicmV2ZXJzZSIsInNob3dOb3RpZmljYXRpb24iLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJIZWxwZXIiLCJsYXp5TG9hZCIsImZpbGxCcmVhZGNydW1iIiwiaGVhZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZGVzY3JpcHRpb24iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwibmFtZSIsImFwcGVuZCIsImlubmVySFRNTCIsInRpdGxlIiwiZmF2b3VyaXRlVG9nZ2xlIiwidHlwZSIsInZhbHVlIiwiY2hlY2tlZCIsImlzX2Zhdm9yaXRlIiwidG9nZ2xlTGJsIiwiYXBwZW5kQ2hpbGQiLCJhZGRyZXNzIiwiaW1nU3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJhZGQiLCJzcmMiLCJpbWFnZVNSQ1NldFVybHNGb3JSZXN0YXVyYW50IiwiYWx0IiwiZ2V0UGhvdG9EZXNjcmlwdGlvbiIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsInVwZGF0ZUlzRmF2b3VyaXRlIiwibm93IiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIm1vbnRoIiwiZGF5IiwieWVhciIsImlzRmF2b3VyaXRlIiwicmVzdGF1cmFudF9pZCIsInBhcnNlSW50IiwiY3JlYXRlZEF0Iiwic2VuZERhdGEiLCJ0aGVuIiwiYSIsInNhdmVMb2NhbGx5IiwiZGF0YSIsIl91cGRhdGVEQiIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWFkeSIsInJlZyIsInN5bmMiLCJyZWdpc3RlciIsImNhdGNoIiwibXNnIiwib3B0aW9ucyIsImJ1dHRvbnMiLCJjcmVhdGUiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwidGltZSIsImNvbnRhaW5lciIsInVsIiwiaW5zZXJ0QmVmb3JlIiwiZmlsbFN1Ym1pdFJldmlld0Zvcm1IVE1MIiwibGVuZ3RoIiwibm9SZXZpZXdzIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImRhdGUiLCJyYXRpbmciLCJjb21tZW50cyIsImZvcm0iLCJtZXRob2QiLCJyZXN0YXVyYW50SUQiLCJuYW1lU2hlbGwiLCJuYW1lTGJsIiwiZm9yIiwibmFtZUlucHV0IiwicGxhY2Vob2xkZXIiLCJyYXRpbmdTaGVsbCIsInJhdGluZ0xibCIsInJhdGluZ09wdGlvbnMiLCJpIiwib3B0aW9uIiwiY29tbWVudHNTaGVsbCIsImNvbW1lbnRzTGJsIiwiY29tbWVudHNUZXh0Iiwic3VibWl0U2hlbGwiLCJzdWJtaXRCdG4iLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdFJldmlldyIsIkZEIiwiRm9ybURhdGEiLCJiYWREYXRhIiwic2FmZVN0ciIsImVzY2FwZSIsInBhcmVudE5vZGUiLCJ1bmVzY2FwZSIsInJldmlld05vZGUiLCJyZW1vdmVDaGlsZCIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwi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QUFjNUcsc0JBQ2Q2RyxLQUFLTixHQUN2QixPQUFLSSxFQUVBQSxFQUFRLEdBRU5HLG1CQUFtQkgsRUFBUSxHQUFHRCxRQUFRLE1BQU8sTUFEM0MsR0FGQSIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudCwgcmV2aWV3cztcbnZhciBtYXA7XG5cbi8qKlxuICogRmV0Y2ggZGF0YSBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBEQkhlbHBlci5yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcbiAgdGhpcy5fdG9hc3RzVmlldyA9IG5ldyBUb2FzdCgpO1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKCk7XG59KTtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7XG4gICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgem9vbTogMTYsXG4gICAgICBjZW50ZXI6IHNlbGYucmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICB9KTtcbiAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKCkgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIC8vY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkge1xuICAgIC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIHNob3dOb3RpZmljYXRpb24oJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJyk7XG4gICAgcmV0dXJuO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoRGF0YUJ5SWQoJ3Jlc3RhdXJhbnRzJywgaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmIChlcnJvciAmJiAhcmVzdGF1cmFudCkge1xuICAgICAgICBzaG93Tm90aWZpY2F0aW9uKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBEQkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChpZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gICAgICAgIHNlbGYucmV2aWV3cyA9IHJldmlld3MucmV2ZXJzZSgpO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgICBIZWxwZXIubGF6eUxvYWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgZmlsbEJyZWFkY3J1bWIoKTtcblxuICBjb25zdCBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJyk7XG4gIGRlc2NyaXB0aW9uLnNldEF0dHJpYnV0ZSgnbmFtZScsICdkZXNjcmlwdGlvbicpO1xuICBkZXNjcmlwdGlvbi5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnLCBgRGV0YWlsZWQgaW5mb3JtYXRpb24gYWJvdXQgJHtyZXN0YXVyYW50Lm5hbWV9YCk7XG4gIGhlYWQuYXBwZW5kKGRlc2NyaXB0aW9uKTtcblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbmFtZS50aXRsZSA9ICdyZXN0YXVyYW50IG5hbWUnO1xuICBjb25zdCBmYXZvdXJpdGVUb2dnbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBmYXZvdXJpdGVUb2dnbGUudHlwZSA9ICdjaGVja2JveCc7XG4gIGZhdm91cml0ZVRvZ2dsZS5uYW1lID0gJ2Zhdm91cml0ZSc7XG4gIGZhdm91cml0ZVRvZ2dsZS52YWx1ZSA9ICdmYXZvdXJpdGUnO1xuICBmYXZvdXJpdGVUb2dnbGUuaWQgPSAnZmF2b3VyaXRlJztcbiAgZmF2b3VyaXRlVG9nZ2xlLmNoZWNrZWQgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlO1xuICBmYXZvdXJpdGVUb2dnbGUuc2V0QXR0cmlidXRlKCdvbmNoYW5nZScsICd1cGRhdGVJc0Zhdm91cml0ZSgpJyk7XG4gIGNvbnN0IHRvZ2dsZUxibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHRvZ2dsZUxibC5zZXRBdHRyaWJ1dGUoJ2ZvcicsICdmYXZvdXJpdGUnKTtcbiAgbmFtZS5hcHBlbmRDaGlsZChmYXZvdXJpdGVUb2dnbGUpO1xuICBuYW1lLmFwcGVuZENoaWxkKHRvZ2dsZUxibCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGFkZHJlc3MudGl0bGUgPSAncmVzdGF1cmFudCBhZGRyZXNzJztcblxuICBjb25zdCBpbWdTcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgdHJ1ZSk7XG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLmNsYXNzTGlzdC5hZGQoJ2xhenknKTtcbiAgaW1hZ2Uuc3JjID0gaW1nU3JjO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpKTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsIERCSGVscGVyLmltYWdlU1JDU2V0VXJsc0ZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgWycxeCcsICcyeCddKSk7XG4gIGltYWdlLmFsdCA9IChyZXN0YXVyYW50LnBob3RvZ3JhcGgpID8gREJIZWxwZXIuZ2V0UGhvdG9EZXNjcmlwdGlvbihyZXN0YXVyYW50KSA6XG4gICdubyBwaWN0dXJlIGZvdW5kJztcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuICBjdWlzaW5lLnRpdGxlID0gJ3Jlc3RhdXJhbnQgY3Vpc2luZSB0eXBlJztcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBmaWxsUmV2aWV3c0hUTUwoKTtcbn1cblxuLyoqXG4gKiBIYWRsZSBmYXZvdXJpdGUgdG9nZ2xlXG4gKi9cbiB1cGRhdGVJc0Zhdm91cml0ZSA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gICBjb25zdCBpc19mYXZvcml0ZSA9IChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKSA/IDAgOiAxO1xuXG4gICBjb25zdCBvcHRpb25zID0ge21vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnLCB5ZWFyOiAnbnVtZXJpYyd9O1xuICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLXVzJywgb3B0aW9ucyk7XG4gICBjb25zdCBpc0Zhdm91cml0ZSA9IHtcbiAgICAgXCJyZXN0YXVyYW50X2lkXCI6IHJlc3RhdXJhbnQuaWQsXG4gICAgIFwiaXNfZmF2b3JpdGVcIjogcGFyc2VJbnQoaXNfZmF2b3JpdGUpLFxuICAgICBcImNyZWF0ZWRBdFwiOiBub3dcbiAgIH1cblxuICAgc2VuZERhdGEoaXNGYXZvdXJpdGUpLnRoZW4oKGEpID0+IHtcbiAgICAgc2F2ZUxvY2FsbHkoKVxuICAgfSk7XG4gfVxuXG4vKipcbiAqIFNlbmQgZGF0YVxuICovXG4gc2VuZERhdGEgPSAoZGF0YSkgPT4ge1xuICByZXR1cm4gREJIZWxwZXIuX3VwZGF0ZURCKCduZXdJc0Zhdm91cml0ZScsIGRhdGEpLnRoZW4oKCkgPT4ge1xuICAgIC8vIFdhaXQgZm9yIHRoZSBzY29wZWQgc2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uIHRvIGdldCBhXG4gICAgLy8gc2VydmljZSB3b3JrZXIgd2l0aCBhbiBhY3RpdmUgc3RhdGVcbiAgICByZXR1cm4gbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7XG4gIH0pLnRoZW4ocmVnID0+IHtcbiAgICByZXR1cm4gcmVnLnN5bmMucmVnaXN0ZXIoJ3NlbmQtaXNGYXZvdXJpdGUnKTtcbiAgfSkudGhlbigoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbihgUmVzdGF1cmFudCBpcyAkeyhkYXRhLmlzX2Zhdm9yaXRlKSA/ICdmYXZvdXJpdGUgbm93IDopJyA6ICdub3QgZmF2b3VyaXRlIGFueW1vcmUgOignfWApO1xuICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgc2hvd05vdGlmaWNhdGlvbignT29wcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuIDooJyk7XG4gIH0pO1xufVxuXG5zYXZlTG9jYWxseSA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSAhcmVzdGF1cmFudC5pc19mYXZvcml0ZTtcbiAgcmV0dXJuIERCSGVscGVyLl91cGRhdGVEQigncmVzdGF1cmFudHMnLCByZXN0YXVyYW50KS50aGVuKCgpID0+IHtcbiAgICAvL2NvbnNvbGUubG9nKCd1cGRhdGVkIGxvY2FsIGNvcHknKTtcbiAgfSk7XG59XG5cbi8qKlxuICogRGlzcGxheSBub3RpZmljYXRpb25zLlxuICovXG5zaG93Tm90aWZpY2F0aW9uID0gKG1zZywgb3B0aW9ucyA9IHtidXR0b25zOiBbJ2Rpc21pc3MnXX0pID0+IHtcbiAgdGhpcy5fdG9hc3RzVmlldy5jcmVhdGUobXNnLCBvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIGRheS5jbGFzc05hbWUgPSAnb3BlbmhvdXJzLWRheSc7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgdGltZS5jbGFzc05hbWUgPSAnb3BlbmhvdXJzLXRpbWUnO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXZpZXdzKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XG4gIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUodGl0bGUsIHVsKTtcblxuICBmaWxsU3VibWl0UmV2aWV3Rm9ybUhUTUwodWwpO1xuXG4gIGlmIChyZXZpZXdzLmxlbmd0aCA9PT0gMCkge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcbiAgfSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbmFtZS5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBuYW1lLnRpdGxlID0gXCJyZXZpZXdlcidzIG5hbWVcIjtcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycsIG9wdGlvbnMpO1xuICBkYXRlLmlubmVySFRNTCA9IGNyZWF0ZWRBdDtcbiAgZGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3LWRhdGUnO1xuICBkYXRlLnRpdGxlID0gJ2RhdGUgd2hlbiByZXZpZXcgd2FzIHBvc3RlZCc7XG4gIGxpLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xuICByYXRpbmcuY2xhc3NOYW1lID0gJ3Jldmlldy1yYXRpbmcnO1xuICByYXRpbmcudGl0bGUgPSAnZ2l2ZW4gcmF0aW5nJztcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb21tZW50cy5jbGFzc05hbWUgPSAncmV2aWV3LWNvbW1lbnRzJztcbiAgY29tbWVudHMudGl0bGUgPSAnY29tbWVudHMgZnJvbSB0aGUgcmV2aWV3ZXInO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqICBDcmVhdGUgYSBIVE1MIHN1Ym1pdCBmb3JtIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxTdWJtaXRSZXZpZXdGb3JtSFRNTCA9ICh1bCwgcmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gIGZvcm0uaWQgPSAnZm9ybS1yZXZpZXcnO1xuICBmb3JtLm1ldGhvZCA9ICdQT1NUJztcbiAgZm9ybS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQWRkIHJldmlldyBmb3IgcmVzdGF1cmFudCcpO1xuXG4gIGNvbnN0IHJlc3RhdXJhbnRJRCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIHJlc3RhdXJhbnRJRC5pZCA9ICdyZXN0YXVyYW50X2lkJztcbiAgcmVzdGF1cmFudElELm5hbWUgPSAncmVzdGF1cmFudF9pZCc7XG4gIHJlc3RhdXJhbnRJRC50eXBlID0gJ2hpZGRlbic7XG4gIHJlc3RhdXJhbnRJRC52YWx1ZSA9IHJlc3RhdXJhbnQuaWQ7XG4gIGZvcm0uYXBwZW5kQ2hpbGQocmVzdGF1cmFudElEKTtcblxuICBjb25zdCBuYW1lU2hlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWVTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBjb25zdCBuYW1lTGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgbmFtZUxibC5pbm5lckhUTUwgPSAnKiBOYW1lOic7XG4gIG5hbWVMYmwuZm9yID0gJ3VOYW1lJztcbiAgbmFtZUxibC50aXRsZSA9IFwicmV2aWV3ZXIncyBuYW1lXCI7XG4gIG5hbWVTaGVsbC5hcHBlbmRDaGlsZChuYW1lTGJsKTtcblxuICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBuYW1lSW5wdXQuaWQgPSAndU5hbWUnO1xuICBuYW1lSW5wdXQubmFtZSA9ICduYW1lJ1xuICBuYW1lSW5wdXQucGxhY2Vob2xkZXIgPSAnWW91ciBOYW1lJztcbiAgbmFtZUlucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1yZXF1aXJlZCcsICd0cnVlJylcbiAgbmFtZUlucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdZb3VyIG5hbWUnKTtcbiAgbmFtZUxibC5hcHBlbmRDaGlsZChuYW1lSW5wdXQpO1xuICBmb3JtLmFwcGVuZENoaWxkKG5hbWVTaGVsbCk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLXVzJywgb3B0aW9ucyk7XG4gIGRhdGUuaW5uZXJIVE1MID0gbm93O1xuICBkYXRlLmNsYXNzTmFtZSA9ICdyZXZpZXctZGF0ZSc7XG4gIGRhdGUudGl0bGUgPSAnZGF0ZSB3aGVuIHJldmlldyBpcyBwb3N0ZWQnO1xuICBmb3JtLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIGNvbnN0IHJhdGluZ1NoZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmdTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LXJhdGluZyc7XG4gIGNvbnN0IHJhdGluZ0xibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHJhdGluZ0xibC5pbm5lckhUTUwgPSAnUmF0aW5nOic7XG4gIGNvbnN0IHJhdGluZ09wdGlvbnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTtcbiAgcmF0aW5nT3B0aW9ucy5uYW1lID0gJ3JhdGluZyc7XG4gIGZvciAodmFyIGkgPSAxOyBpIDw9IDU7IGkrKykge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi52YWx1ZSA9IGk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGk7XG4gICAgcmF0aW5nT3B0aW9ucy5hcHBlbmRDaGlsZChvcHRpb24pO1xuICB9XG4gIHJhdGluZ0xibC5hcHBlbmRDaGlsZChyYXRpbmdPcHRpb25zKTtcbiAgcmF0aW5nU2hlbGwuYXBwZW5kQ2hpbGQocmF0aW5nTGJsKTtcbiAgZm9ybS5hcHBlbmRDaGlsZChyYXRpbmdTaGVsbCk7XG5cbiAgY29uc3QgY29tbWVudHNTaGVsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHNTaGVsbC5jbGFzc05hbWUgPSAncmV2aWV3LWNvbW1lbnRzJztcbiAgY29uc3QgY29tbWVudHNMYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICBjb21tZW50c0xibC5pbm5lckhUTUwgPSAnKiBDb21tZW50czonO1xuICBjb25zdCBjb21tZW50c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICBjb21tZW50c1RleHQubmFtZSA9ICdjb21tZW50cyc7XG4gIGNvbW1lbnRzVGV4dC5pZCA9ICdjb21tZW50c1RleHQnO1xuICBjb21tZW50c1RleHQuc2V0QXR0cmlidXRlKCdhcmlhLXJlcXVpcmVkJywgJ3RydWUnKVxuICBjb21tZW50c1RleHQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0FkZGl0aW9uYWwgY29tbWVudHMgZm9yIHRoZSByZXZpZXcnKTtcbiAgY29tbWVudHNTaGVsbC5hcHBlbmRDaGlsZChjb21tZW50c0xibCk7XG4gIGNvbW1lbnRzU2hlbGwuYXBwZW5kQ2hpbGQoY29tbWVudHNUZXh0KTtcbiAgZm9ybS5hcHBlbmRDaGlsZChjb21tZW50c1NoZWxsKTtcblxuICBjb25zdCBzdWJtaXRTaGVsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3Qgc3VibWl0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIHN1Ym1pdEJ0bi5pZCA9ICdzdWJtaXRCdG4nO1xuICBzdWJtaXRCdG4udHlwZSA9ICdzdWJtaXQnO1xuICBzdWJtaXRCdG4uaW5uZXJIVE1MID0gJ1N1Ym1pdCBSZXZpZXchJztcbiAgc3VibWl0QnRuLnZhbHVlID0gJ1N1Ym1pdCc7XG4gIHN1Ym1pdEJ0bi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnU3VibWl0IHJldmlldycpO1xuICBzdWJtaXRTaGVsbC5hcHBlbmRDaGlsZChzdWJtaXRCdG4pO1xuICBmb3JtLmFwcGVuZENoaWxkKHN1Ym1pdFNoZWxsKTtcblxuICBsaS5hcHBlbmRDaGlsZChmb3JtKTtcbiAgdWwuYXBwZW5kQ2hpbGQobGkpO1xuXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgc3VibWl0UmV2aWV3KGZvcm0pO1xuICB9KTtcbn1cblxuLyoqXG4qIFN1Ym1pdCByZXZpZXdzIHRob3VnaCBqYXZhc2NyaXB0LlxuKi9cbnN1Ym1pdFJldmlldyA9IChmb3JtKSA9PiB7XG4gIC8vIEJpbmQgdGhlIEZvcm1EYXRhIG9iamVjdCBhbmQgdGhlIGZvcm0gZWxlbWVudFxuICBjb25zdCBGRCA9IG5ldyBGb3JtRGF0YShmb3JtKTtcblxuICBjb25zdCByZXZpZXcgPSB7fTtcbiAgbGV0IGJhZERhdGEgPSBmYWxzZTtcbiAgRkQuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgY29uc3Qgc2FmZVN0ciA9IGVzY2FwZSh2YWx1ZSk7XG4gICAgaWYgKHNhZmVTdHIgPT09ICcnKSB7XG4gICAgICBzaG93Tm90aWZpY2F0aW9uKGBPaCBubyEgU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSBjaGVjayAke2tleX0gZmllbGRgKTtcbiAgICAgIGJhZERhdGEgPSB0cnVlO1xuICAgIH1cbiAgICByZXZpZXdba2V5XSA9IHNhZmVTdHI7XG4gIH0pO1xuXG4gIHJldmlldy5yYXRpbmcgPSBwYXJzZUludChyZXZpZXcucmF0aW5nKTtcblxuICAvLyBkb24ndCBwb3N0IGJhZGx5IGZvcm1lZCByZXZpZXdzXG4gIGlmIChiYWREYXRhKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IHVsID0gZm9ybS5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IHttb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgeWVhcjogJ251bWVyaWMnfTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLXVzJywgb3B0aW9ucyk7XG4gIHJldmlld1snY3JlYXRlZEF0J10gPSBub3c7XG4gIERCSGVscGVyLl91cGRhdGVEQignbmV3UicsIHJldmlldyk7XG4gIERCSGVscGVyLl91cGRhdGVEQigncmV2aWV3cycsIHJldmlldyk7XG5cbiAgcmV2aWV3Lm5hbWUgPSB1bmVzY2FwZShyZXZpZXcubmFtZSk7XG4gIHJldmlldy5jb21tZW50cyA9IHVuZXNjYXBlKHJldmlldy5jb21tZW50cyk7XG4gIGxldCByZXZpZXdOb2RlID0gY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpO1xuXG4gIHJldHVybiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeS50aGVuKHJlZyA9PiB7XG4gICAgcmV0dXJuIHJlZy5zeW5jLnJlZ2lzdGVyKCdzZW5kLXJldmlld3MnKVxuICB9KS50aGVuKCgpID0+IHtcbiAgICBzaG93Tm90aWZpY2F0aW9uKCdZb3VyIHJldmlldyB3aWxsIGJlIHBvc3RlZCBhcyBzb29uIGFzIHBvc3NpYmxlLicpO1xuICAgIHVsLmluc2VydEJlZm9yZShyZXZpZXdOb2RlLCBmb3JtLnBhcmVudE5vZGUpO1xuICAgIHVsLnJlbW92ZUNoaWxkKGZvcm0ucGFyZW50Tm9kZSk7XG4gIH0pLmNhdGNoKCgpID0+IHtcbiAgICBzaG93Tm90aWZpY2F0aW9uKCdFcnJvcicpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5maWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50JywgJ3BhZ2UnKVxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xufVxuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKVxuICAgIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pXG4gICAgcmV0dXJuICcnO1xuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufVxuIl19
